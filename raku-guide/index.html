<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Raku 入门 :: 山川异域, 风月同天</title>

<meta name="author" content="ohmyraku">
<meta name="application-name" content="山川异域, 风月同天">
<meta name="description" content="本文档旨在为你提供 Raku 编程语言的快速概述。 它可以让 Raku 初学者快速上手。
 本文档的一部分章节涉及 Raku 文档的其他（更完整和准确）部分。 如果你需要有关特定主题的更多信息，你应该阅读它们。
 在本文档中，你会找到大部分所讨论主题的示例。 为了更好地理解它们，请花时间再现所有的例子。
 许可证 本工作根据知识共享署名 - 授权4.0国际许可协议进行许可。 要查看此许可证的副本，请访问
   https://creativecommons.org/licenses/by-sa/4.0/.
   贡献 如果你想对此文档做贡献，请访问：
   https://github.com/hankache/rakuguide
   意见反馈 欢迎所有的反馈： naoum@hankache.com
 如果你喜欢这个工作， 欢迎在 Github 给这个仓库点赞。
 翻译   保加利亚语: https://raku.guide/bg
  中文: https://raku.guide/zh
  荷兰语: https://raku.guide/nl
  法语: https://raku.guide/fr
  德语: https://raku.guide/de
  印度尼西亚语: https://raku.">
<meta name="robots" content="noodp"/>
<meta name="generator" content="Hugo 0.79.0" />
<meta name="referrer" content="no-referrer" />
<meta name="format-detection" content="telephone=no">

<link rel="canonical" href="https://ohmyraku.github.io/raku-guide/" />


<link rel="icon" href="https://ohmyraku.github.io/logo.png" />


<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="Raku 入门" />
<meta name="twitter:description" content="本文档旨在为你提供 Raku 编程语言的快速概述。 它可以让 Raku 初学者快速上手。
 本文档的一部分章节涉及 Raku 文档的其他（更完整和准确）部分。 如果你需要有关特定主题的更多信息，你应该阅读它们。
 在本文档中，你会找到大部分所讨论主题的示例。 为了更好地理解它们，请花时间再现所有的例子。
 许可证 本工作根据知识共享署名 - 授权4.0国际许可协议进行许可。 要查看此许可证的副本，请访问
   https://creativecommons.org/licenses/by-sa/4.0/.
   贡献 如果你想对此文档做贡献，请访问：
   https://github.com/hankache/rakuguide
   意见反馈 欢迎所有的反馈： naoum@hankache.com
 如果你喜欢这个工作， 欢迎在 Github 给这个仓库点赞。
 翻译   保加利亚语: https://raku.guide/bg
  中文: https://raku.guide/zh
  荷兰语: https://raku.guide/nl
  法语: https://raku.guide/fr
  德语: https://raku.guide/de
  印度尼西亚语: https://raku." />
<meta name="twitter:site" content="https://ohmyraku.github.io" />
<meta name="twitter:creator" content="ohmyraku" />
<meta name="twitter:image" content="https://ohmyraku.github.io/logo.png">
<meta property="og:type" content="article" />
<meta property="og:locale" content="en" />
<meta property="og:name" content="ohmyraku" />
<meta property="og:title" content="Raku 入门" />
<meta property="og:url" content="https://ohmyraku.github.io" />
<meta property="og:site_name" content="山川异域, 风月同天" />
<meta property="og:description" content="本文档旨在为你提供 Raku 编程语言的快速概述。 它可以让 Raku 初学者快速上手。
 本文档的一部分章节涉及 Raku 文档的其他（更完整和准确）部分。 如果你需要有关特定主题的更多信息，你应该阅读它们。
 在本文档中，你会找到大部分所讨论主题的示例。 为了更好地理解它们，请花时间再现所有的例子。
 许可证 本工作根据知识共享署名 - 授权4.0国际许可协议进行许可。 要查看此许可证的副本，请访问
   https://creativecommons.org/licenses/by-sa/4.0/.
   贡献 如果你想对此文档做贡献，请访问：
   https://github.com/hankache/rakuguide
   意见反馈 欢迎所有的反馈： naoum@hankache.com
 如果你喜欢这个工作， 欢迎在 Github 给这个仓库点赞。
 翻译   保加利亚语: https://raku.guide/bg
  中文: https://raku.guide/zh
  荷兰语: https://raku.guide/nl
  法语: https://raku.guide/fr
  德语: https://raku.guide/de
  印度尼西亚语: https://raku." />
<script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "Article",
      "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https:\/\/ohmyraku.github.io\/raku-guide\/"
      },
      "headline": "Raku 入门",
      
      "datePublished": "2020-02-05",
      "dateModified": "2020-02-05 15:26:52 \u002b0800 CST",
      "author": {
        "@type": "Person",
        "name": "ohmyraku"
      },
      "description": "本文档旨在为你提供 Raku 编程语言的快速概述。 它可以让 Raku 初学者快速上手。\n 本文档的一部分章节涉及 Raku 文档的其他（更完整和准确）部分。 如果你需要有关特定主题的更多信息，你应该阅读它们。\n 在本文档中，你会找到大部分所讨论主题的示例。 为了更好地理解它们，请花时间再现所有的例子。\n 许可证 本工作根据知识共享署名 - 授权4.0国际许可协议进行许可。 要查看此许可证的副本，请访问\n   https:\/\/creativecommons.org\/licenses\/by-sa\/4.0\/.\n   贡献 如果你想对此文档做贡献，请访问：\n   https:\/\/github.com\/hankache\/rakuguide\n   意见反馈 欢迎所有的反馈： naoum@hankache.com\n 如果你喜欢这个工作， 欢迎在 Github 给这个仓库点赞。\n 翻译   保加利亚语: https:\/\/raku.guide\/bg\n  中文: https:\/\/raku.guide\/zh\n  荷兰语: https:\/\/raku.guide\/nl\n  法语: https:\/\/raku.guide\/fr\n  德语: https:\/\/raku.guide\/de\n  印度尼西亚语: https:\/\/raku.",
      "publisher": {
        "@type": "Organization",
        "name": "https:\/\/ohmyraku.github.io",
        "logo": {
          "@type": "ImageObject",
          "url": "https:\/\/ohmyraku.github.io\/logo.png"
        }
      }
    }
</script><link rel="stylesheet" href="https://ohmyraku.github.io/scss/main.min.84f71d25d375c522a861bb4719728ce6839cf3635b15ca0c7a1b4d799c2dc3399a1d6cb46058a9d8fdbebe9156a8857279cfdeb70aa3862e629de234b5a41fa1.css" integrity="sha512-hPcdJdN1xSKoYbtHGXKM5oOc82NbFcoMehtNeZwtwzmaHWy0YFip2P2&#43;vpFWqIVyec/etwqjhi5ineI0taQfoQ==">
<script>

const theme = window.localStorage.getItem('theme'); 
if (theme && theme !== "1") {
    document.documentElement.classList.add('theme-' + theme);
}
</script>


</head>
<body>
  <main class="site__content">
    <div class="site__page">
  <nav class="site__breadcrumbs">
    <a class="site__breadcrumb" href="https://ohmyraku.github.io/">山川异域, 风月同天</a><a class="site__breadcrumb--active" href="https://ohmyraku.github.io/raku-guide/">Raku 入门</a>
</nav>

<h1 class="page__title">Raku 入门</h1>
  <div class="page__meta">
    <p>
    
    <span class="page__date">
    on <time datetime="2020-02-05T15:26:52&#43;08:00">2020-02-05</time>
    
    </span>
    </p>

    

    
    </div>
</div>


</div>

<article class="page__content" >
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>本文档旨在为你提供 Raku 编程语言的快速概述。
它可以让 Raku 初学者快速上手。</p>
</div>
<div class="paragraph">
<p>本文档的一部分章节涉及 <a href="http://docs.raku.org">Raku 文档</a>的其他（更完整和准确）部分。
如果你需要有关特定主题的更多信息，你应该阅读它们。</p>
</div>
<div class="paragraph">
<p>在本文档中，你会找到大部分所讨论主题的示例。
为了更好地理解它们，请花时间再现所有的例子。</p>
</div>
<div class="paragraph">
<div class="title">许可证</div>
<p>本工作根据知识共享署名 - 授权4.0国际许可协议进行许可。
要查看此许可证的副本，请访问</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://creativecommons.org/licenses/by-sa/4.0/" class="bare">https://creativecommons.org/licenses/by-sa/4.0/</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">贡献</div>
<p>如果你想对此文档做贡献，请访问：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/hankache/rakuguide" class="bare">https://github.com/hankache/rakuguide</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">意见反馈</div>
<p>欢迎所有的反馈：
<a href="mailto:naoum@hankache.com">naoum@hankache.com</a></p>
</div>
<div class="paragraph">
<p>如果你喜欢这个工作， 欢迎在
<a href="https://github.com/hankache/rakuguide">Github</a> 给这个仓库点赞。</p>
</div>
<div class="ulist">
<div class="title">翻译</div>
<ul>
<li>
<p>保加利亚语: <a href="https://raku.guide/bg" class="bare">https://raku.guide/bg</a></p>
</li>
<li>
<p>中文: <a href="https://raku.guide/zh" class="bare">https://raku.guide/zh</a></p>
</li>
<li>
<p>荷兰语: <a href="https://raku.guide/nl" class="bare">https://raku.guide/nl</a></p>
</li>
<li>
<p>法语: <a href="https://raku.guide/fr" class="bare">https://raku.guide/fr</a></p>
</li>
<li>
<p>德语: <a href="https://raku.guide/de" class="bare">https://raku.guide/de</a></p>
</li>
<li>
<p>印度尼西亚语: <a href="https://raku.guide/id" class="bare">https://raku.guide/id</a></p>
</li>
<li>
<p>意大利语 <a href="https://raku.guide/it" class="bare">https://raku.guide/it</a></p>
</li>
<li>
<p>日语: <a href="https://raku.guide/ja" class="bare">https://raku.guide/ja</a></p>
</li>
<li>
<p>葡萄牙语: <a href="https://raku.guide/pt" class="bare">https://raku.guide/pt</a></p>
</li>
<li>
<p>西班牙语: <a href="https://raku.guide/es" class="bare">https://raku.guide/es</a></p>
</li>
<li>
<p>土耳其语: <a href="https://raku.guide/tr" class="bare">https://raku.guide/tr</a></p>
</li>
<li>
<p>俄语: <a href="https://raku.guide/ru" class="bare">https://raku.guide/ru</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_序言">1. 序言</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_什么是_raku">1.1. 什么是 Raku</h3>
<div class="paragraph">
<p>Raku 是一种高级的，通用的，渐进类型的语言。
Raku 是多范式的。它支持过程式编程，面向对象编程和函数式编程。</p>
</div>
<div class="ulist">
<div class="title">Raku motto:</div>
<ul>
<li>
<p>TMTOWTDI (发音是 Tim Toady): 每个问题都有许多解决方式。</p>
</li>
<li>
<p>简单的事情应该保持简单，困难的事情应该变得简单，不可能的事情应该成为可能。</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_术语">1.2. 术语</h3>
<div class="ulist">
<ul>
<li>
<p><strong>Raku</strong>: 带有测试套件的语言规范。
Raku 是通过该规范测试套件的实现。</p>
</li>
<li>
<p><strong>Rakudo</strong>: Raku 的编译器。</p>
</li>
<li>
<p><strong>Rakudobrew</strong>: Rakudo 的安装管理器。</p>
</li>
<li>
<p><strong>Zef</strong>: Raku 的模块安装程序。</p>
</li>
<li>
<p><strong>Rakudo Star</strong>: 是一个包含 Rakudo, Zef, 和经遴选的 Raku 模块与文档的分发包。</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_安装_raku">1.3. 安装 Raku</h3>
<div class="olist arabic">
<div class="title">Linux</div>
<ol class="arabic">
<li>
<p>安装 Rakudo Star: 在终端中运行：</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">wget https://rakudo.perl6.org/downloads/star/rakudo-star-2019.03.tar.gz
tar xfz rakudo-star-2019.03.tar.gz
cd rakudo-star-2019.03
perl Configure.pl --gen-moar --make-install --prefix ~/rakudo</code></pre>
</div>
</div>
<div class="paragraph">
<p>对于其它选项, 请参阅 <a href="http://rakudo.org/how-to-get-rakudo/#Installing-Rakudo-Star-Linux" class="bare">http://rakudo.org/how-to-get-rakudo/#Installing-Rakudo-Star-Linux</a></p>
</div>
<div class="paragraph">
<div class="title">OSX</div>
<p>可用的选择有四种:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>按照在 Linux 上安装步骤进行同样的操作</p>
</li>
<li>
<p>使用 homebrew 安装: <code>brew install rakudo-star</code></p>
</li>
<li>
<p>使用 MacPorts 安装: <code>sudo port install rakudo</code></p>
</li>
<li>
<p>从 <a href="https://rakudo.org/latest/star/macos" class="bare">https://rakudo.org/latest/star/macos</a> 下载最新的安装器(.dmg 后缀的文件)</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Windows</div>
<ol class="arabic">
<li>
<p>从 或 下载最新的安装器(.msi 后缀的文件)<br/></p>
</li>
<li>
<p>如果你的系统架构是 64-bit, 可以从 <a href="https://rakudo.org/latest/star/win64" class="bare">https://rakudo.org/latest/star/win64</a> 下载最新的安装器(.msi 后缀的文件); 如果是 32-bit, 则从 <a href="https://rakudo.org/latest/star/win32" class="bare">https://rakudo.org/latest/star/win32</a> 下载最新的安装器(.msi 后缀的文件）。</p>
</li>
<li>
<p>安装完成后，确保 <code>C:\rakudo\bin</code> 在 PATH 中。</p>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Docker</div>
<ol class="arabic">
<li>
<p>获取官方的 Docker 镜像 <code>docker pull rakudo-star</code></p>
</li>
<li>
<p>然后运行一个带有该镜像的容器 <code>docker run -it rakudo-star</code></p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_运行_raku_代码">1.4. 运行 Raku 代码</h3>
<div class="paragraph">
<p>运行 Raku 代码可以通过使用 REPL（Read-Eval-Print 循环)来实现。
实现方法是，打开命令行终端，输入 <code>perl6</code> 后回车。这会导致命令提示符 <code>&gt;</code> 的出现。接着, 输入一行代码后回车。
REPL 将会打印出该行的返回值。然后你可以输入另外的行, 或输入 <code>exit</code> 并回车以离开 REPL。</p>
</div>
<div class="paragraph">
<p>或者，你可以在文件中编写你的代码，保存后再运行。建议 Raku 脚本文件的扩展名设定为 <code>.raku</code>。
运行该文件的代码时只需将 <code>perl6 filename.raku</code> 输入到命令行终端后回车即可。
但不像 REPL, 这不会自动打印出每一行的结果：这里要求文件中的代码必须包含 <code>say</code> 那样的语句以打印输出。</p>
</div>
<div class="paragraph">
<p>REPL 大多用于测试特殊代码片段，通常只有有一行。对于超过一行的程序，建议先把它们保存到文件中而后再运行。</p>
</div>
<div class="paragraph">
<p>单行代码也通过在命令行中键入  <code>perl6 -e &#39;your code here&#39;</code> 并回车来以非交互的方式来测试。</p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Rakudo Star 搭载了一个行编辑器来帮你最大程度地利用 REPL。</p>
</div>
<div class="paragraph">
<p>如果你安装了普通的 Rakudo 而不是 Rakudo Star，那么你的行编辑功能可能没有开启（利用上下方向键查询历史;左右方向键以编辑输入;TAB 键以完成当前行输入）功能。
此时可以考虑运行以下命令来设置好上述功能：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>zef install Linenoise</code> 能在 Windows, Linux 和 OSX 上工作</p>
</li>
<li>
<p><code>zef install Readline</code> 如果你使用 Linux 并且偏好 <em>Readline</em> 库</p>
</li>
</ul>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="_编辑器">1.5. 编辑器</h3>
<div class="paragraph">
<p>因为大多数情况下我们会在文件中编写并存储 Raku 程序，因此我们需要一个优雅的而且能识别 Raku 语法的文本编辑器。</p>
</div>
<div class="paragraph">
<p>从个人角度来说，我推荐正在使用的 <a href="https://atom.io/">Atom</a>。
这是一个时尚的文本编辑器，带有开箱即用的 Raku 语法高亮功能。
<a href="https://atom.io/packages/language-perl6">Raku FE</a> 是相对于 Atom 默认 Raku 语法高亮插件的另一种选择，也可以高亮 Raku 的语法，该软件来源于原始的包，
但存在很多 bug 需要修补和编辑。</p>
</div>
<div class="paragraph">
<p>社区里的其他同伴也有使用 <a href="http://www.vim.org/">Vim</a> ， <a href="https://www.gnu.org/software/emacs/">Emacs</a> 和 <a href="http://padre.perlide.org/">Padre</a> 的。</p>
</div>
<div class="paragraph">
<p>最新版本的 Vim 自带 Raku 语法高亮的功能，Emacs 和 Padre 则需要另行安装额外的包。</p>
</div>
</div>
<div class="sect2">
<h3 id="_hello_world">1.6. Hello World!</h3>
<div class="paragraph">
<p>我们会从 <code>hello world</code> 惯例程序开始。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">say &#39;hello world&#39;;</code></pre>
</div>
</div>
<div class="paragraph">
<p>它也可以被写为:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">&#39;hello world&#39;.say;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_语法概要">1.7. 语法概要</h3>
<div class="paragraph">
<p>Raku 是 <strong>形式自由的</strong>, (大多数时候)你可以使用任意数量的空格。</p>
</div>
<div class="paragraph">
<p><strong>语句</strong> 通常是一个逻辑代码行, 它们需要以一个分号结尾:
<code>say &#34;Hello&#34; if True;</code></p>
</div>
<div class="paragraph">
<p><strong>表达式</strong> 是一种能够返回值的特殊类型的语句:
<code>1+2</code> 会返回 <code>3</code></p>
</div>
<div class="paragraph">
<p>表达式由 <strong>项</strong> 和 <strong>运算符</strong> 组成。</p>
</div>
<div class="paragraph">
<p><strong>项</strong> 是:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>变量</strong>: 一个可以被操作和改变的值。</p>
</li>
<li>
<p><strong>字面值</strong>: 一个像数字或字符串那样的常量值。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>运算符</strong> 的分类:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;"/>
<col style="width: 33.3333%;"/>
<col style="width: 33.3334%;"/>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>类型</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>解释</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>示例</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">前缀</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">用在项前</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>++1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">中缀</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">用在项与项之间</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1+2</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">后缀</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">用在项后</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1++</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">环缀</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">包围项</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>(1)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">后环缀</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">在一个项之后, 包围另一个项</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Array[1]</code></p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="_标识符">1.7.1. 标识符</h4>
<div class="paragraph">
<p>标识符是你定义项时给它们起的名字。</p>
</div>
<div class="ulist">
<div class="title">命名规则:</div>
<ul>
<li>
<p>它们必须以字母字符或下划线开头。</p>
</li>
<li>
<p>它们可以包含数字 (除了第一个字符)。</p>
</li>
<li>
<p>它们可以包含破折号或撇号(除了第一个和最后一个字符), 前提是每个破折号或撇号的右侧有一个字母字符。</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;"/>
<col style="width: 50%;"/>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>有效标识符</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>无效标识符</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>var1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1var</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>var-one</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>var-1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>var’one</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>var&#39;1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>var1_</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>var1&#39;</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>_var</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-var</code></p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<div class="title">命名约定:</div>
<ul>
<li>
<p>驼峰式: <code>variableNo1</code></p>
</li>
<li>
<p>串联式: <code>variable-no1</code></p>
</li>
<li>
<p>蛇行式: <code>variable_no1</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>你可以随意命名标识符，但是最好采用一个命名约定。</p>
</div>
<div class="paragraph">
<p>使用有意义的名称将减轻你（和其他人）的编程工作负担。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>var1 = var2 * var3</code> 在语法上是正确的，但它的意图不明显。</p>
</li>
<li>
<p><code>monthly-salary = daily-rate * working-days</code> 是更好的命名变量的方法。</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_注释">1.7.2. 注释</h4>
<div class="paragraph">
<p>注释是用于注解的文本片段, 编译器会忽略注释。</p>
</div>
<div class="paragraph">
<p>注释被分为 3 种类型:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>单行注释:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6"># This is a single line comment</code></pre>
</div>
</div>
</li>
<li>
<p>嵌套的注释:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">say #`(This is an embedded comment) &#34;Hello World.&#34;</code></pre>
</div>
</div>
</li>
<li>
<p>多行注释:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">=begin comment
This is a multi line comment.
Comment 1
Comment 2
=end comment</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_引号">1.7.3. 引号</h4>
<div class="paragraph">
<p>字符串被双引号或单引号包围。</p>
</div>
<div class="paragraph">
<p>必须使用双引号, 如果:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>你的字符串包含单引号。</p>
</li>
<li>
<p>你的字符串包含需要被替换的变量。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">say &#39;Hello World&#39;;   # Hello World
say &#34;Hello World&#34;;   # Hello World
say &#34;Don&#39;t&#34;;         # Don&#39;t
my $name = &#39;John Doe&#39;;
say &#39;Hello $name&#39;;   # Hello $name
say &#34;Hello $name&#34;;   # Hello John Doe</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_运算符">2. 运算符</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_一般运算符">2.1. 一般运算符</h3>
<div class="paragraph">
<p>下表列出了最常用的运算符。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 7.1428%;"/>
<col style="width: 7.1428%;"/>
<col style="width: 28.5714%;"/>
<col style="width: 28.5714%;"/>
<col style="width: 28.5716%;"/>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle">运算符</th>
<th class="tableblock halign-center valign-middle">类型</th>
<th class="tableblock halign-left valign-middle">描述</th>
<th class="tableblock halign-left valign-middle">例子</th>
<th class="tableblock halign-left valign-middle">结果</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>+</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>中缀</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">加</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>1 + 2</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>3</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>中缀</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">减</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>3 - 1</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>2</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>*</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>中缀</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">乘</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>3 * 2</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>6</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>**</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>中缀</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">指数</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>3 ** 2</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>9</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>/</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>中缀</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">除</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>3 / 2</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>1.5</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle" rowspan="2"><p class="tableblock"><code>div</code></p></td>
<td class="tableblock halign-center valign-middle" rowspan="2"><p class="tableblock"><code>中缀</code></p></td>
<td class="tableblock halign-left valign-middle" rowspan="2"><p class="tableblock">整除 (向下取整)</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>3 div 2</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>(-3) div 2</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>-2</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>%</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>中缀</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">取模</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>7 % 4</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>3</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle" rowspan="2"><p class="tableblock"><code>%%</code></p></td>
<td class="tableblock halign-center valign-middle" rowspan="2"><p class="tableblock"><code>中缀</code></p></td>
<td class="tableblock halign-left valign-middle" rowspan="2"><p class="tableblock">是否能整除</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>6 %% 4</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>False</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>6 %% 3</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>True</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>gcd</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>中缀</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">最大公约数</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>6 gcd 9</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>3</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>lcm</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>中缀</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">最小公倍数</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>6 lcm 9</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>18</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>==</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>中缀</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">数值相等</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>9 == 7</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>False</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>!=</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>中缀</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">数值不等</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>9 != 7</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>True</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>&lt;</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>中缀</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">数值小于</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>9 &lt; 7</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>False</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>&gt;</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>中缀</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">数值大于</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>9 &gt; 7</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>True</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>&lt;=</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>中缀</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">数值小于等于</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>7 &lt;= 7</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>True</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>&gt;=</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>中缀</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">数值大于等于</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>9 &gt;= 7</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>True</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle" rowspan="3"><p class="tableblock"><code>&lt;=&gt;</code></p></td>
<td class="tableblock halign-center valign-middle" rowspan="3"><p class="tableblock"><code>中缀</code></p></td>
<td class="tableblock halign-left valign-middle" rowspan="3"><p class="tableblock">数值比较</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>1 &lt;=&gt; 1.0</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>Same</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>1 &lt;=&gt; 2</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>Less</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>3 &lt;=&gt; 2</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>More</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>eq</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>中缀</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">字符串相等</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>&#34;John&#34; eq &#34;John&#34;</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>True</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>ne</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>中缀</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">字符串不等</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>&#34;John&#34; ne &#34;Jane&#34;</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>True</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>lt</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>中缀</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">字符串小于</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>&#34;a&#34; lt &#34;b&#34;</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>True</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>gt</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>中缀</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">字符串大于</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>&#34;a&#34; gt &#34;b&#34;</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>False</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>le</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>中缀</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">字符串小于等于</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>&#34;a&#34; le &#34;a&#34;</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>True</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>ge</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>中缀</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">字符串大于等于</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>&#34;a&#34; ge &#34;b&#34;</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>False</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle" rowspan="3"><p class="tableblock"><code>leg</code></p></td>
<td class="tableblock halign-center valign-middle" rowspan="3"><p class="tableblock"><code>中缀</code></p></td>
<td class="tableblock halign-left valign-middle" rowspan="3"><p class="tableblock">字符串比较</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>&#34;a&#34; leg &#34;a&#34;</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>Same</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>&#34;a&#34; leg &#34;b&#34;</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>Less</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>&#34;c&#34; leg &#34;b&#34;</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>More</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle" rowspan="2"><p class="tableblock"><code>cmp</code></p></td>
<td class="tableblock halign-center valign-middle" rowspan="2"><p class="tableblock"><code>中缀</code></p></td>
<td class="tableblock halign-left valign-middle" rowspan="2"><p class="tableblock">智能比较</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>&#34;a&#34; cmp &#34;b&#34;</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>Less</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>3.5 cmp 2.6</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>More</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>=</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>中缀</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">赋值</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>my $var = 7</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>将字面值 <code>7</code> 赋值给变量 <code>$var</code></code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle" rowspan="2"><p class="tableblock"><code>~</code></p></td>
<td class="tableblock halign-center valign-middle" rowspan="2"><p class="tableblock"><code>中缀</code></p></td>
<td class="tableblock halign-left valign-middle" rowspan="2"><p class="tableblock">字符串连接</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>9 ~ 7</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>97</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>&#34;Hi &#34; ~ &#34;there&#34;</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>Hi there</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle" rowspan="2"><p class="tableblock"><code>x</code></p></td>
<td class="tableblock halign-center valign-middle" rowspan="2"><p class="tableblock"><code>中缀</code></p></td>
<td class="tableblock halign-left valign-middle" rowspan="2"><p class="tableblock">字符串重复</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>13 x 3</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>131313</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>&#34;Hello &#34; x 3</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>Hello Hello Hello</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle" rowspan="5"><p class="tableblock"><code>~~</code></p></td>
<td class="tableblock halign-center valign-middle" rowspan="5"><p class="tableblock"><code>中缀</code></p></td>
<td class="tableblock halign-left valign-middle" rowspan="5"><p class="tableblock">智能匹配</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>2 ~~ 2</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>True</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>2 ~~ Int</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>True</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>&#34;Raku&#34; ~~ &#34;Raku&#34;</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>True</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>&#34;Raku&#34; ~~ Str</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>True</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>&#34;enlightenment&#34; ~~ /light/</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>｢light｣</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle" rowspan="2"><p class="tableblock"><code>++</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>前缀</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">递增</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>my $var = 2; ++$var;</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>递增变量然后返回变量值 <code>3</code></code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>后缀</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">递增</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>my $var = 2; $var++;</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>返回变量值 <code>2</code> 然后递增变量</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle" rowspan="2"><p class="tableblock"><code>--</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>前缀</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">递减</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>my $var = 2; --$var;</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>递减变量然后返回变量值 <code>1</code></code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>后缀</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">递减</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>my $var = 2; $var--;</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>返回变量值 <code>2</code> 然后递减变量</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle" rowspan="3"><p class="tableblock"><code>+</code></p></td>
<td class="tableblock halign-center valign-middle" rowspan="3"><p class="tableblock"><code>前缀</code></p></td>
<td class="tableblock halign-left valign-middle" rowspan="3"><p class="tableblock">强制转变为数值</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>+&#34;3&#34;</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>3</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>+True</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>+False</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle" rowspan="3"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-center valign-middle" rowspan="3"><p class="tableblock"><code>前缀</code></p></td>
<td class="tableblock halign-left valign-middle" rowspan="3"><p class="tableblock">强制转换为数值并返回相反数</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>-&#34;3&#34;</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>-3</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>-True</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>-1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>-False</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle" rowspan="6"><p class="tableblock"><code>?</code></p></td>
<td class="tableblock halign-center valign-middle" rowspan="6"><p class="tableblock"><code>前缀</code></p></td>
<td class="tableblock halign-left valign-middle" rowspan="6"><p class="tableblock">强制转换为布尔值</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>?0</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>False</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>?9.8</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>True</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>?&#34;Hello&#34;</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>True</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>?&#34;&#34;</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>False</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>my $var; ?$var;</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>False</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>my $var = 7; ?$var;</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>True</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>!</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>前缀</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">强制转换为布尔值并返回相反数</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>!4</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>False</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>..</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>中缀</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Range 构造函数</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>0..5</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>创建区间 [0,5] <sup class="footnote" id="_footnote_intervals">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup></code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>..^</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>中缀</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Range 构造函数</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>0..^5</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>创建区间 [0,5) <sup class="footnoteref">[<a class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup></code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>^..</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>中缀</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Range 构造函数</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>0^..5</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>创建区间 (0,5] <sup class="footnoteref">[<a class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup></code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>^..^</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>中缀</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Range 构造函数</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>0^..^5</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>创建区间 (0,5) <sup class="footnoteref">[<a class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup></code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>^</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>前缀</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Range 构造函数</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>^5</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>等价于0..^5，创建区间 [0,5) <sup class="footnoteref">[<a class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup></code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>...</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>中缀</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">惰性列表构造函数</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>0...9999</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>只有接到请求时才返回元素</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle" rowspan="2"><p class="tableblock"><code>|</code></p></td>
<td class="tableblock halign-center valign-middle" rowspan="2"><p class="tableblock"><code>前缀</code></p></td>
<td class="tableblock halign-left valign-middle" rowspan="2"><p class="tableblock">扁平化</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>|(0..5)</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>(0 1 2 3 4 5)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>|(0^..^5)</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>(1 2 3 4)</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_反转运算符">2.2. 反转运算符</h3>
<div class="paragraph">
<p>在任何运算符前加 <code>R</code> 就可以得到调换运算符两边的参数后运算的结果。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;"/>
<col style="width: 25%;"/>
<col style="width: 25%;"/>
<col style="width: 25%;"/>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-middle">正常运算符</th>
<th class="tableblock halign-left valign-middle">结果</th>
<th class="tableblock halign-left valign-middle">反转运算符</th>
<th class="tableblock halign-left valign-middle">结果</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>2 / 3</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>0.666667</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>2 R/ 3</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>1.5</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>2 - 1</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>2 R- 1</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>-1</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_归约运算符">2.3. 归约运算符</h3>
<div class="paragraph">
<p>归约运算符应用于一个值的列表。
归约运算符由被方括号 <code>[]</code> 包围的运算符来表示。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;"/>
<col style="width: 25%;"/>
<col style="width: 25%;"/>
<col style="width: 25%;"/>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-middle">正常运算符</th>
<th class="tableblock halign-left valign-middle">结果</th>
<th class="tableblock halign-left valign-middle">归约运算符</th>
<th class="tableblock halign-left valign-middle">结果</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>1 + 2 + 3 + 4 + 5</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>15</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>[+] 1,2,3,4,5</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>15</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>1 * 2 * 3 * 4 * 5</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>120</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>[*] 1,2,3,4,5</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>120</code></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
可以到 <a href="https://docs.raku.org/language/operators" class="bare">https://docs.raku.org/language/operators</a> 查看完整的运算符列表和它们的优先级。
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_变量">3. 变量</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Raku 中的变量分为 3 类：标量、数组和哈希。</p>
</div>
<div class="paragraph">
<p>变量名以 <strong>魔符</strong> (sigil) 开头以区分不同类型。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>$</code> 用于标量 (scalar)</p>
</li>
<li>
<p><code>@</code> 用于数组 (array)</p>
</li>
<li>
<p><code>%</code> 用于哈希 (hash)</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_标量">3.1. 标量</h3>
<div class="paragraph">
<p>标量用于存储一项数据或引用。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">#字符串
my $name = &#39;John Doe&#39;;
say $name;

#整数
my $age = 99;
say $age;</code></pre>
</div>
</div>
<div class="paragraph">
<p>特定数据类型的标量对应一组作用于它的操作。</p>
</div>
<div class="listingblock">
<div class="title">字符串</div>
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">my $name = &#39;John Doe&#39;; # 对于字符串类型
say $name.uc;          # .uc 将字母全部大写
say $name.chars;       # .chars 获得字符串的字符数, 即字符串长度
say $name.flip;        # .flip 返回翻转字符串的结果</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">JOHN DOE
8
eoD nhoJ</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
所有可应用于字符串的方法列表，请参照 <a href="https://docs.raku.org/type/Str" class="bare">https://docs.raku.org/type/Str</a>
</td>
</tr>
</tbody></table>
</div>
<div class="listingblock">
<div class="title">整数</div>
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">my $age = 17;
say $age.is-prime; # .is-prime 判断整数值是否为质数</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">True</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
所有可应用于整数的方法列表，请参照 <a href="https://docs.raku.org/type/Int" class="bare">https://docs.raku.org/type/Int</a>
</td>
</tr>
</tbody></table>
</div>
<div class="listingblock">
<div class="title">有理数</div>
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">my $age = 2.3;
say $age.numerator;   # .numerator 获得有理数值对应最简分数的分子
say $age.denominator; # .denominator 获得有理数值对应最简分数的分母
say $age.nude;        # .nude 同时获得分子分母</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">23
10
(23 10)</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
所有可应用于有理数的方法列表，请参照 <a href="https://docs.raku.org/type/Rat" class="bare">https://docs.raku.org/type/Rat</a>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="_数组">3.2. 数组</h3>
<div class="paragraph">
<p>数组是储存有多个值的列表。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">my @animals = &#39;camel&#39;,&#39;llama&#39;,&#39;owl&#39;;
say @animals;</code></pre>
</div>
</div>
<div class="paragraph">
<p>下面例子中的操作可以应用于列表：</p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
波浪符 <code>~</code> 可用于列表中字符串的连接。
</td>
</tr>
</tbody></table>
</div>
<div class="listingblock">
<div class="title"><code>脚本</code></div>
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">my @animals = &#39;camel&#39;,&#39;vicuña&#39;,&#39;llama&#39;;
say &#34;动物园容纳了 &#34; ~ @animals.elems ~ &#34; 只动物&#34;;
say &#34;这些动物是: &#34; ~ @animals;
say &#34;动物园收养了一只 owl&#34;;
@animals.push(&#34;owl&#34;);
say &#34;现在动物园有: &#34; ~ @animals;
say &#34;动物园收养的第一只动物是 &#34; ~ @animals[0];
@animals.pop;
say &#34;不幸的是， owl 走了，还剩下: &#34; ~ @animals;
say &#34;我们要关闭动物园，只留下一只动物&#34;;
say &#34;我们要放走: &#34; ~ @animals.splice(1,2) ~ &#34; ，只剩下 &#34; ~ @animals;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><code>输出</code></div>
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">动物园容纳了 3 只动物
这些动物是: camel vicuña llama
动物园收养了一只 owl
现在动物园有: camel vicuña llama owl
动物园收养的第一只动物是 camel
不幸的是， owl 走了，还剩下: camel vicuña llama
我们要关闭动物园，只留下一只动物
我们要放走: vicuña llama ，只剩下 camel</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">说明</div>
<p><code>.elems</code> 返回列表中的元素个数。<br/>
<code>.push()</code>  向数组追加一个或多个元素。<br/>
我们可以通过提供元素在数组中的位置来访问数组中特定元素 <code>@animals[0]</code>。<br/>
<code>.pop</code> 删除并返回数组中最后一个元素。<br/>
<code>.splice(a,b)</code> 会删除从位置 <code>a</code> 开始的 <code>b</code> 个元素。</p>
</div>
<div class="sect3">
<h4 id="_定长数组">3.2.1. 定长数组</h4>
<div class="paragraph">
<p>一般数组通过以下方式声明:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">my @array;</code></pre>
</div>
</div>
<div class="paragraph">
<p>一般的数组的长度可以无限，因此被叫做自动扩展。<br/>
它可以接受任意个数的元素而不受限制。</p>
</div>
<div class="paragraph">
<p>对应地，我们可以创建一个定长数组。<br/>
在这种数组中不能访问下标超过定义大小的元素。</p>
</div>
<div class="paragraph">
<p>可以通过在变量名后的方括号中指定最大元素个数来定义定长数组的长度:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">my @array[3];</code></pre>
</div>
</div>
<div class="paragraph">
<p>这个数组最多可以储存 3 个变量，索引从 0 开始, 到 2 结束。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">my @array[3];
@array[0] = &#34;first value&#34;;
@array[1] = &#34;second value&#34;;
@array[2] = &#34;third value&#34;;</code></pre>
</div>
</div>
<div class="paragraph">
<p>我们不能在这个数组中添加第四个元素：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">my @array[3];
@array[0] = &#34;first value&#34;;
@array[1] = &#34;second value&#34;;
@array[2] = &#34;third value&#34;;
@array[3] = &#34;fourth value&#34;;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">Index 3 for dimension 1 out of range (must be 0..2) 第一维的索引值 3 超出了范围（必须是0..2)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_多维数组">3.2.2. 多维数组</h4>
<div class="paragraph">
<p>到现在为止我们看到的数组还都是一维的。<br/>
幸运的是，我们在 Raku 中能定义多维数组。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">my @tbl[3;2];</code></pre>
</div>
</div>
<div class="paragraph">
<p>这是一个二维数组。
它的第一个维度最多可以有 3 个水平，第二个维度最多可以有 2 个水平。</p>
</div>
<div class="paragraph">
<p>可以把它看成 3x2 的矩阵。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">my @tbl[3;2];
@tbl[0;0] = 1;
@tbl[0;1] = &#34;x&#34;;
@tbl[1;0] = 2;
@tbl[1;1] = &#34;y&#34;;
@tbl[2;0] = 3;
@tbl[2;1] = &#34;z&#34;;
say @tbl</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">[[1 x] [2 y] [3 z]]</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">数组的可视化表示:</div>
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">[1 x]
[2 y]
[3 z]</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
对于完整的数组参考资料，请参照 <a href="https://docs.raku.org/type/Array" class="bare">https://docs.raku.org/type/Array</a>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_hashes_哈希">3.3. Hashes 哈希</h3>
<div class="listingblock">
<div class="title">哈希是一组键值对。</div>
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">my %capitals = (&#39;UK&#39;,&#39;London&#39;,&#39;Germany&#39;,&#39;Berlin&#39;);
say %capitals;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">另一种填充哈希的方法:</div>
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">my %capitals = (UK =&gt; &#39;London&#39;, Germany =&gt; &#39;Berlin&#39;);
say %capitals;</code></pre>
</div>
</div>
<div class="paragraph">
<p>一些能应用于哈希的方法:</p>
</div>
<div class="listingblock">
<div class="title"><code>脚本</code></div>
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">my %capitals = (UK =&gt; &#39;London&#39;, Germany =&gt; &#39;Berlin&#39;);
%capitals.push: (France =&gt; &#39;Paris&#39;);
say %capitals.kv;
say %capitals.keys;
say %capitals.values;
say &#34;The capital of France is: &#34; ~ %capitals&lt;France&gt;;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><code>输出</code></div>
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">(France Paris Germany Berlin UK London)
(France Germany UK)
(Paris Berlin London)
The capital of France is: Paris</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">说明</div>
<p><code>.push:(key =&gt; &#34;value&#34;)</code> 添加一个新键值对。<br/>
<code>.kv</code> 返回一个包含所有键值对的列表。<br/>
<code>.keys</code> 返回一个包含所有键的列表。<br/>
<code>.values</code> 返回一个包含所有值的列表。<br/>
我们可以通过哈希中特定值所对应的键来访问这个值。 <code>%hash&lt;key&gt;</code></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
完整的哈希参考资料，请参照 <a href="https://docs.raku.org/type/Hash" class="bare">https://docs.raku.org/type/Hash</a>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="_类型">3.4. 类型</h3>
<div class="paragraph">
<p>前面的例子中，我们并没有指定变量中值的类型。</p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<code>.WHAT</code> 会返回变量中值的类型。
</td>
</tr>
</tbody></table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">my $var = &#39;Text&#39;;
say $var;
say $var.WHAT;

$var = 123;
say $var;
say $var.WHAT;</code></pre>
</div>
</div>
<div class="paragraph">
<p>在上面的例子中，你能看到变量 <code>$var</code> 中的值先是(Str)后是(Int)。</p>
</div>
<div class="paragraph">
<p>这种编程风格被称作动态类型。动态在这里是指变量可以储存任何类型的值。</p>
</div>
<div class="paragraph">
<p>接下来试着运行下面的例子:<br/>
注意在变量名前的 <code>Int</code>。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">my Int $var = &#39;Text&#39;;
say $var;
say $var.WHAT;</code></pre>
</div>
</div>
<div class="paragraph">
<p>运行会失败并返回报错信息: <code>Type check failed in assignment to $var; expected Int but got Str 赋值给$var时类型检查失败，预期Int但是得到Str</code></p>
</div>
<div class="paragraph">
<p>这是因为我们预先指定变量类型为(Int),当将(Str)赋值给它的时候就导致了运行失败。</p>
</div>
<div class="paragraph">
<p>这种编程风格被称为静态类型编程。静态在这里是指变量类型在赋值前定义并且不能在更改。</p>
</div>
<div class="paragraph">
<p>Raku 属于 <strong>渐进类型</strong> ;它同时支持 <strong>静态</strong> 和 <strong>动态</strong> 类型。</p>
</div>
<div class="listingblock">
<div class="title">数组和哈希同样可以为静态类型:</div>
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">my Int @array = 1,2,3;
say @array;
say @array.WHAT;

my Str @multilingual = &#34;Hello&#34;,&#34;Salut&#34;,&#34;Hallo&#34;,&#34;你好&#34;,&#34;안녕하세요&#34;,&#34;こんにちは&#34;;
say @multilingual;
say @multilingual.WHAT;

my Str %capitals = (UK =&gt; &#39;London&#39;, Germany =&gt; &#39;Berlin&#39;);
say %capitals;
say %capitals.WHAT;

my Int %country-codes = (UK =&gt; 44, Germany =&gt; 49);
say %country-codes;
say %country-codes.WHAT;

my Str %student-name{Int} = (1 =&gt; &#39;Alex&#39;, 2 =&gt; &#39;Mary&#39;);
say %student-name;
say %student-name.WHAT;</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">下面是最常用的类型:</div>
<p>你可能永远不会用到前两种类型，他们被列出来只是为了让你知道。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;"/>
<col style="width: 42.8571%;"/>
<col style="width: 28.5714%;"/>
<col style="width: 14.2858%;"/>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code><strong>类型</strong></code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code><strong>描述</strong></code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code><strong>例子</strong></code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code><strong>结果</strong></code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>Mu</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>Raku 的基础类型</code></p></td>
<td class="tableblock halign-left valign-middle"></td>
<td class="tableblock halign-left valign-middle"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>Any</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>新类和大部分内部类的默认基类</code></p></td>
<td class="tableblock halign-left valign-middle"></td>
<td class="tableblock halign-left valign-middle"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>Cool</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>既可以被当做数值也可以作为字符串</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>my Cool $var = 31; say $var.flip; say $var * 2;</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>13 62</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>Str</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>字符串</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>my Str $var = &#34;NEON&#34;; say $var.flip;</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>NOEN</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>Int</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>整数（任意精度）</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>7 + 7</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>14</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>Rat</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>有理数（有限精度）</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>0.1 + 0.2</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>0.3</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>Bool</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>布尔类型</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>!True</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>False</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_自省">3.5. 自省</h3>
<div class="paragraph">
<p>自省是获取对象属性信息的过程，比如获取对象的类型。<br/>
在前面的一个例子中我们使用 <code>.WHAT</code> 来获取变量的类型。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">my Int $var;
say $var.WHAT;    # (Int)
my $var2;
say $var2.WHAT;   # (Any)
$var2 = 1;
say $var2.WHAT;   # (Int)
$var2 = &#34;Hello&#34;;
say $var2.WHAT;   # (Str)
$var2 = True;
say $var2.WHAT;   # (Bool)
$var2 = Nil;
say $var2.WHAT;   # (Any)</code></pre>
</div>
</div>
<div class="paragraph">
<p>变量的类型和它储存的值有关。<br/>
使用强声明定义的空变量，它的类型就是声明的类型<br/>
一个不是强声明定义的空变量，它的类型是 <code>(Any)</code><br/>
可以通过赋 <code>Nil</code> 给变量，来清除变量的值。</p>
</div>
</div>
<div class="sect2">
<h3 id="_作用域">3.6. 作用域</h3>
<div class="paragraph">
<p>在第一次使用变量之前，变量需要被声明。</p>
</div>
<div class="paragraph">
<p>在 Raku 中可以使用使用多种声明方式。其中 <code>my</code> 已经在上述例子中使用到。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">my $var=1;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>my</code> 声明指定了变量上下文作用域。
换句话说，这个变量只能在它被定义的块中被访问。</p>
</div>
<div class="paragraph">
<p>Raku 中块有 <code>{}</code> 界定。
如果没有块存在，那么变量就在整个 Raku 脚本中可用。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">{
  my Str $var = &#39;Text&#39;;
  say $var; # 可以使用
}
say $var;   # 不能使用, 会报错</code></pre>
</div>
</div>
<div class="paragraph">
<p>因为一个变量只有在定义它的块中有效，所以同样的变量名可以在另一个块中使用。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">{
  my Str $var = &#39;Text&#39;;
  say $var;
}
my Int $var = 123;
say $var;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_赋值_vs_绑定">3.7. 赋值 vs. 绑定</h3>
<div class="paragraph">
<p>我们已经在前面的例子中看到如何将值 <strong>赋</strong> 给变量。<br/>
<strong>赋值</strong> 通过 <code>=</code> 操作符完成。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">my Int $var = 123;
say $var;</code></pre>
</div>
</div>
<div class="paragraph">
<p>我们可以改变赋给变量的值:</p>
</div>
<div class="listingblock">
<div class="title">赋值</div>
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">my Int $var = 123;
say $var;
$var = 999;
say $var;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><code>输出</code></div>
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">123
999</code></pre>
</div>
</div>
<div class="paragraph">
<p>我们不能改变 <strong>绑定</strong> 到变量上的值<br/>
<strong>绑定</strong> 通过 <code>:=</code> 操作符实现。</p>
</div>
<div class="listingblock">
<div class="title">绑定</div>
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">my Int $var := 123;
say $var;
$var = 999;
say $var;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><code>输出</code></div>
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">123
Cannot assign to an immutable value 不允许赋值到一个不可变值</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">变量也可以绑定到其他变量:</div>
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">my $a;
my $b;
$b := $a;
$a = 7;
say $b;
$b = 8;
say $a;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><code>输出</code></div>
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">7
8</code></pre>
</div>
</div>
<div class="paragraph">
<p>就像你已经注意到的那样，绑定变量是双向的。<br/>
<code>$a := $b</code> 和 <code>$b := $a</code> 拥有同样的效果.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
关于变量的更多信息，请参见 <a href="https://docs.raku.org/language/variables" class="bare">https://docs.raku.org/language/variables</a>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_函数和修改器">4. 函数和修改器</h2>
<div class="sectionbody">
<div class="paragraph">
<p>把函数和修改器区分开来很重要。<br/>
函数在调用的时候不改变对象的初始状态。<br/>
修改器改变对象的状态。</p>
</div>
<div class="listingblock">
<div class="title"><code>脚本</code></div>
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">my @numbers = [7,2,4,9,11,3];

@numbers.push(99);
say @numbers;      #1

say @numbers.sort; #2
say @numbers;      #3

@numbers.=sort;
say @numbers;      #4</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><code>输出</code></div>
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">[7 2 4 9 11 3 99] #1
(2 3 4 7 9 11 99) #2
[7 2 4 9 11 3 99] #3
[2 3 4 7 9 11 99] #4</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">说明</div>
<p><code>.push</code> 是一个修改器，它会改变数组的状态。(#1)</p>
</div>
<div class="paragraph">
<p><code>.sort</code> 是一个函数，它返回排序后的数组，但是不改变原始数组。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>(#2) 展示了它返回排序后的数组。</p>
</li>
<li>
<p>(#3) 展示了原始数组没有被修改。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>为了强制一个函数作为修改器那样对原始数据进行修改，而我们可以使用 <code>.=</code> 来代替 <code>.</code> (#4) (脚本的第9行)</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_循环和条件语句">5. 循环和条件语句</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Raku 有多种条件和循环结构。</p>
</div>
<div class="sect2">
<h3 id="_if">5.1. if</h3>
<div class="paragraph">
<p>仅在条件满足（条件表达式结果为 <code>True</code>）时运行代码。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">my $age = 19;

if $age &gt; 18 {
  say &#39;Welcome&#39;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>在 Raku 中我们能倒装条件语句和待运行的代码。<br/>
将待运行的代码和条件语句倒装后，条件语句总是优先被执行。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">my $age = 19;

say &#39;Welcome&#39; if $age &gt; 18;</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果条件不满足，我们可以指定执行另一个代码块：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>else</code></p>
</li>
<li>
<p><code>elsif</code></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6"># 为变量不同的值运行相同的代码
my $座位数 = 9;

if $座位数 &lt;= 5 {
  say &#39;我是小轿车&#39;
} elsif $座位数 &lt;= 7 {
  say &#39;我是七座车&#39;
} else {
  say &#39;我是面包车&#39;
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_unless">5.2. unless</h3>
<div class="paragraph">
<p><code>unless</code> 是否定形式的 if。</p>
</div>
<div class="paragraph">
<p>下面这些代码：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">my $clean-shoes = False;

if not $clean-shoes {
  say &#39;Clean your shoes&#39;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>可以改写成：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">my $clean-shoes = False;

unless $clean-shoes {
  say &#39;Clean your shoes&#39;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>否</code> 运算在 Raku 中用 <code>！</code> 或 <code>not</code> 来实现。</p>
</div>
<div class="paragraph">
<p><code>unless (条件)</code> 可以用来代替 <code>if not (条件)</code>。</p>
</div>
<div class="paragraph">
<p>需要注意 <code>unless</code> 不能配合使用 <code>else</code>。</p>
</div>
</div>
<div class="sect2">
<h3 id="_with">5.3. with</h3>
<div class="paragraph">
<p><code>with</code> 的用法和 <code>if</code> 相同, 不过 <code>with</code> 会检查变量是否已经定义。<br/>
如果变量没有定义，那么就不会执行块中的代码。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">my Int $var=1;

with $var {
  say &#39;Hello&#39;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>以下代码中，如果你没有给 <code>$var</code> 赋值，那么代码块就不会被执行。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">my Int $var;

with $var {
  say &#39;Hello&#39;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>without</code> 是否定版的 <code>with</code>。你可以拿 <code>if</code> 和 <code>unless</code> 的关系做类比。</p>
</div>
<div class="paragraph">
<p>如果第一个 <code>with</code> 条件不能满足，替代执行的代码块可以使用 <code>orwith</code> 来指定。<br/>
<code>with</code> 和 <code>orwith</code> 的关系可以同 <code>if</code> 与 <code>elsif</code> 的关系相比较。</p>
</div>
</div>
<div class="sect2">
<h3 id="_for">5.4. for</h3>
<div class="paragraph">
<p><code>for</code> 循环可以迭代多个值。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">my @array = [1,2,3];

for @array -&gt; $array-item {
  say $array-item * 100
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>需要注意到我们创建了一个循环变量 <code>$array-item</code> 用来对每个数组元素进行 <code>*100</code> 的操作。</p>
</div>
</div>
<div class="sect2">
<h3 id="_given">5.5. given</h3>
<div class="paragraph">
<p>在 Raku 中的 <code>given</code>  类似其他语言中的 switch，但是要更加地强大。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">my $var = 42;

given $var {
    when 0..50 { say &#39;Less than or equal to 50&#39;}
    when Int { say &#34;is an Int&#34; }
    when 42  { say 42 }
    default  { say &#34;huh?&#34; }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>在成功匹配后，匹配就会停止。</p>
</div>
<div class="paragraph">
<p>如果在匹配成功后运行的代码块中加了 <code>proceed</code>，那么就要在下一次成功匹配后才停止匹配。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">my $var = 42;

given $var {
    when 0..50 { say &#39;Less than or equal to 50&#39;;proceed}
    when Int { say &#34;is an Int&#34;;proceed}
    when 42  { say 42 }
    default  { say &#34;huh?&#34; }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_loop">5.6. loop</h3>
<div class="paragraph">
<p><code>loop</code> 是进行 <code>for</code> 循环的另一种方式。<br/>
Raku 中 C 语言家族的 <code>for</code> 循环使用 <code>loop</code> 来表示。<br/>
Raku 是 C 语言家族中的一员。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">loop (my $i = 0; $i &lt; 5; $i++) {
  say &#34;The current number is $i&#34;
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
更多关于循环和条件语句的信息，参见 <a href="https://docs.raku.org/language/control" class="bare">https://docs.raku.org/language/control</a>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_io">6. I/O</h2>
<div class="sectionbody">
<div class="paragraph">
<p>在 Raku 中，两个最常用的输入/输出的端口是终端和文件。</p>
</div>
<div class="sect2">
<h3 id="_在终端中基本的_io_操作">6.1. 在终端中基本的 I/O 操作</h3>
<div class="sect3">
<h4 id="_say">6.1.1. say</h4>
<div class="paragraph">
<p><code>say</code> 能输出到标准输出，而且它还会在输出的最后添加一个换行符，请见下面的示例代码：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">say &#39;Hello Mam.&#39;;
say &#39;Hello Sir.&#39;;</code></pre>
</div>
</div>
<div class="paragraph">
<p>会在两行中分别打印出来。</p>
</div>
</div>
<div class="sect3">
<h4 id="_print">6.1.2. print</h4>
<div class="paragraph">
<p><code>print</code> 的功能和 <code>say</code> 相似，但是它不会在输出内容后添加换行符。</p>
</div>
<div class="paragraph">
<p>试试将 <code>say</code> 换成 <code>print</code> 比较一下它们两者的特点。</p>
</div>
</div>
<div class="sect3">
<h4 id="_get">6.1.3. get</h4>
<div class="paragraph">
<p><code>get</code> 用来获取终端中的输入。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">my $name;

say &#34;Hi, what&#39;s your name?&#34;;
$name = get;

say &#34;Dear $name welcome to Raku&#34;;</code></pre>
</div>
</div>
<div class="paragraph">
<p>当上面的代码运行时，终端会等你输入名字和回车键。
然后就会向你打招呼。</p>
</div>
</div>
<div class="sect3">
<h4 id="_prompt">6.1.4. prompt</h4>
<div class="paragraph">
<p><code>prompt</code> 整合了 <code>print</code> 和 <code>get</code> 的功能。</p>
</div>
<div class="paragraph">
<p>以上的例子可以改写成以下方式：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">my $name = prompt &#34;Hi, what&#39;s your name? &#34;;

say &#34;Dear $name welcome to Raku&#34;;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_运行_shell_命令">6.2. 运行 Shell 命令</h3>
<div class="paragraph">
<p>有两种子例程可以用来运行 shell 命令：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>run</code> 不通过 shell 运行外部命令。</p>
</li>
<li>
<p><code>shell</code> 通过系统 shell 来运行命令。它依赖系统平台和它的 shell。
所有的保留字(meta chracters) 会被 shell 解释，包括管道(pipes)、重定向、环境变量替换等等。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">如果你用的是 Linux 或 OSX 请运行以下代码：</div>
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">my $name = &#39;Neo&#39;;
run &#39;echo&#39;, &#34;hello $name&#34;;
shell &#34;ls&#34;;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">如果你用的是 Windows 请运行下面这段代码：</div>
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">shell &#34;dir&#34;;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>echo</code> 和 <code>ls</code> 是常用的 Linux shell 命令<br/>
<code>echo</code> 打印文本到终端（和 Raku 中的 <code>print</code> 相同<br/>
<code>ls</code> 列出当前目录下所有的文件和文件夹。</p>
</div>
<div class="paragraph">
<p><code>dir</code> 在 Windows 中和 <code>ls</code> 的功能相同。</p>
</div>
</div>
<div class="sect2">
<h3 id="_file_io">6.3. File I/O</h3>
<div class="sect3">
<h4 id="_slurp">6.3.1. slurp</h4>
<div class="paragraph">
<p><code>slurp</code> 用来从文件中读入数据。</p>
</div>
<div class="paragraph">
<p>建立一个文本文件包含以下内容：</p>
</div>
<div class="listingblock">
<div class="title">datafile.txt</div>
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">John 9
Johnnie 7
Jane 8
Joanna 7</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">my $data = slurp &#34;datafile.txt&#34;;
say $data;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_spurt">6.3.2. spurt</h4>
<div class="paragraph">
<p><code>spurt</code> 用来向文件写入数据。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">my $newdata = &#34;New scores:
Paul 10
Paulie 9
Paulo 11&#34;;

spurt &#34;newdatafile.txt&#34;, $newdata;</code></pre>
</div>
</div>
<div class="paragraph">
<p>在运行上述代码后，一个存储有 New score 的文件 <em>newdatafile.txt</em> 会被创建。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_文件和文件目录操作">6.4. 文件和文件目录操作</h3>
<div class="paragraph">
<p>在先前的例子中，Raku 能不使用 shell 命令的情况下列出一个目录下所有的内容。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">say dir;              # 列出当前目录下的文件和文件夹
say dir &#34;/Documents&#34;; # 列出特定目录下的文件和文件夹</code></pre>
</div>
</div>
<div class="paragraph">
<p>另外你还能创建和删除目录。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">mkdir &#34;newfolder&#34;;
rmdir &#34;newfolder&#34;;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>mkdir</code> 创建一个新的目录。<br/>
<code>rmdir</code> 删除一个空目录，如果目录不为空则返回 error。</p>
</div>
<div class="paragraph">
<p>你还可以检查特定的路径是否存在：</p>
</div>
<div class="paragraph">
<p>在你要运行以下脚本的目录中，建立一个叫 <code>folder123</code> 的空文件夹和一个文件 <code>script123.raku</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">say &#34;script123.raku&#34;.IO.e;
say &#34;folder123&#34;.IO.e;

say &#34;script123.raku&#34;.IO.d;
say &#34;folder123&#34;.IO.d;

say &#34;script123.raku&#34;.IO.f;
say &#34;folder123&#34;.IO.f;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>IO.e</code> 检查文件夹或文件是否存在。<br/>
<code>IO.f</code> 检查路径所指的是否为文件。<br/>
<code>IO.d</code> 检查路径所指的是否为文件夹。</p>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Windows 下使用 <code>/</code> 或 <code>\\</code> 来定义目录<br/>
<code>C:\\rakudo\\bin</code><br/>
<code>C:/rakudo/bin</code><br/>
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
更多关于 I/O，详见 <a href="https://docs.raku.org/type/IO" class="bare">https://docs.raku.org/type/IO</a>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_子例程">7. 子例程</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_定义">7.1. 定义</h3>
<div class="paragraph">
<p><strong>子例程</strong> (也叫 <strong>subs</strong> 或 <strong>functions</strong> ) 是一种功能集的打包。<br/></p>
</div>
<div class="paragraph">
<p>定义子例程时以关键字 <code>sub</code> 起始。在定义之后你能通过子例程名来进行调用。<br/>
让我们来看下面的例子：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">sub alien-greeting {
  say &#34;Hello earthlings&#34;;
}

alien-greeting;</code></pre>
</div>
</div>
<div class="paragraph">
<p>上面的例子给我们展示了一个不需要输入参数的子例程。</p>
</div>
</div>
<div class="sect2">
<h3 id="_signature_函数签名">7.2. Signature 函数签名</h3>
<div class="paragraph">
<p>很多子例程需要多个输入才能运行。这些输入由 <strong>参数</strong> 提供。
一个子例程可以不定义或定义多个 <strong>参数</strong>。
子例程所定义的参数之个数与类型称为它的 <strong>函数签名</strong>。</p>
</div>
<div class="paragraph">
<p>下面的子例程接收一个字符串参数。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">sub say-hello (Str $name) {
    say &#34;Hello &#34; ~ $name ~ &#34;!!!!&#34;
}
say-hello &#34;Paul&#34;;
say-hello &#34;Paula&#34;;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_多重分派">7.3. 多重分派</h3>
<div class="paragraph">
<p>我们可以定义多个有相同命名但有不同函数签名的的子例程。
当这样的子例程被调用的时候，运行环境会根据提供的参数之数量和类型判断那个版本的同名子例程来运行。
这种子例程和普通的子例程的定义方法是一样的，不过我们需要使用 <code>multi</code> 来代替原先的 <code>sub</code>。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">multi greet($name) {
    say &#34;Good morning $name&#34;;
}
multi greet($name, $title) {
    say &#34;Good morning $title $name&#34;;
}

greet &#34;Johnnie&#34;;
greet &#34;Laura&#34;,&#34;Mrs.&#34;;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_默认参数和可选参数">7.4. 默认参数和可选参数</h3>
<div class="paragraph">
<p>如果一个子例程被定义需要一个参数，但是我们调用它的时候没有提供所需的参数，那么这个子例程就不能运行。</p>
</div>
<div class="paragraph">
<p>不过 Raku 提供了：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>可选参数</p>
</li>
<li>
<p>默认参数</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>可选参数在定义的时候需要在参数名后加 <code>?</code>。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">sub say-hello($name?) {
  with $name { say &#34;Hello &#34; ~ $name }
  else { say &#34;Hello Human&#34; }
}
say-hello;
say-hello(&#34;Laura&#34;);</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果使用者没有提供参数，那么它就默认使用预先给定的值。<br/>
上面是通过在子例程中给参数赋值的方式实现的。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">sub say-hello($name=&#34;Matt&#34;) {
  say &#34;Hello &#34; ~ $name;
}
say-hello;
say-hello(&#34;Laura&#34;);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_返回值">7.5. 返回值</h3>
<div class="paragraph">
<p>我们现在为止看到的子例程都在终端中打印一些文字。</p>
</div>
<div class="paragraph">
<p>一些时候我们需要让子例程 <strong>返回</strong> 值让我们能在我们的程序中能重复使用。</p>
</div>
<div class="paragraph">
<p>在一般的情景下，子例程代码的最后一行被默认为返回值。</p>
</div>
<div class="listingblock">
<div class="title">隐式返回</div>
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">sub squared ($x) {
  $x ** 2;
}
say &#34;7 squared is equal to &#34; ~ squared(7);</code></pre>
</div>
</div>
<div class="paragraph">
<p>一旦我们的代码变多，清楚地指明我们需要返回的变量是很有用的。
可以使用 <code>return</code> 关键字来指明返回变量。</p>
</div>
<div class="listingblock">
<div class="title">显式返回</div>
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">sub squared ($x) {
  return $x ** 2;
}
say &#34;7 squared is equal to &#34; ~ squared(7);</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_限制返回值">7.5.1. 限制返回值</h4>
<div class="paragraph">
<p>在之前的例子中，我们对将子例程的参数限定为特定类型。
我们可以同样地限定返回值的类型。</p>
</div>
<div class="paragraph">
<p>为了将返回值限定为特定类型，我们可以使用 <code>returns</code> 特征 (trait) 或在函数签名中使用箭标。</p>
</div>
<div class="listingblock">
<div class="title">使用 rerurns 特征</div>
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">sub squared ($x) returns Int {
  return $x ** 2;
}
say &#34;1.2 squared is equal to &#34; ~ squared(1.2);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">使用箭头</div>
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">sub squared ($x --&gt; Int) {
  return $x ** 2;
}
say &#34;1.2 squared is equal to &#34; ~ squared(1.2);</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果子例程不能提供符合类型要求的返回值，程序就会报错。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">Type check failed for return value; expected Int but got Rat (1.44) 返回值类型检查失败，预期Int但是得到Rat（1.44）</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>类型限制不仅可以控制返回值的类型，还可以控制返回值的定义状态。</p>
</div>
<div class="paragraph">
<p>之前的例子中，我们指定了返回值必须为 <code>Int</code>。<br/>
还可以进一步严格指定返回值 <code>Int</code> 是已定义（defined）或未定义（undefined）的：<br/>
<code>--&gt; Int:D</code> 和 <code>--&gt; Int:U</code></p>
</div>
<div class="paragraph">
<p>使用类型限制是一个好的习惯。<br/>
以下是将前面的例子修改后的结果，其中使用 <code>:D</code> 强制返回已定义的 <code>Int</code>。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">sub squared ($x --&gt; Int:D) {
  return $x ** 2;
}
say &#34;1.2 squared is equal to &#34; ~ squared(1.2);</code></pre>
</div>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
关于更多子例程和函数的资料，详见 <a href="https://docs.raku.org/language/functions" class="bare">https://docs.raku.org/language/functions</a>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_函数式编程">8. 函数式编程</h2>
<div class="sectionbody">
<div class="paragraph">
<p>在本章中，我们将看看一些有利于函数式编程的功能。</p>
</div>
<div class="sect2">
<h3 id="_函数是一等公民">8.1. 函数是一等公民</h3>
<div class="paragraph">
<p>函数/子例程是一等公民:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>它们能作为参数传递</p>
</li>
<li>
<p>它们能从另外一个函数中返回</p>
</li>
<li>
<p>它们能被赋值给变量</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>map</code> 函数是用来说明这个概念的极好例子。<br/>
<code>map</code> 是 <strong>高阶函数</strong>, 它接收另外一个函数作为参数。</p>
</div>
<div class="listingblock">
<div class="title">脚本</div>
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">my @array = &lt;1 2 3 4 5&gt;;
sub squared($x) {
    $x ** 2
}
say map(&amp;squared, @array);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">输出</div>
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">(1 4 9 16 25)</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">解释</div>
<p>我们定义了一个叫做 <code>squared</code> 的子例程, 它接收一个数字并返回该数字的二次幂。<br/>
下一步, 我们使用 <code>map</code> 这个高阶函数并传递给它两个参数, 一个子例程和一个数组。<br/>
结果是所有数组元素的平方组成的列表。</p>
</div>
<div class="paragraph">
<p>注意当传递子例程作为参数时, 我们需要在子例程的名字前添加一个 <code>&amp;</code> 符号。</p>
</div>
</div>
<div class="sect2">
<h3 id="_匿名函数">8.2. 匿名函数</h3>
<div class="paragraph">
<p><strong>匿名函数</strong> 也叫做 <strong>拉姆达</strong>(lambda)。<br/>
匿名函数没有绑定到标识符(匿名函数没有名字)。</p>
</div>
<div class="paragraph">
<p>让我们使用匿名函数重写 <code>map</code> 那个例子。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">my @array = &lt;1 2 3 4 5&gt;;
say map(-&gt; $x {$x ** 2}, @array);</code></pre>
</div>
</div>
<div class="paragraph">
<p>注意我们没有声明子例程并把它作为参数传递给 <code>map</code>, 而是在里面直接定义了匿名函数。<br/>
匿名函数 <code>-&gt; $x {$x ** 2}</code> 没有句柄并且不能被调用。</p>
</div>
<div class="paragraph">
<p>按照 Raku 的说法我们把这个标记叫做 <strong>pointy block</strong>。</p>
</div>
<div class="listingblock">
<div class="title">pointy block 也能用于把函数赋值给变量:</div>
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">my $squared = -&gt; $x {
    $x ** 2
}
say $squared(9);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_链式调用">8.3. 链式调用</h3>
<div class="paragraph">
<p>在 Raku中, 方法可以链接起来, 你不再需要把一个方法的结果作为参数传递给另外一个方法了。</p>
</div>
<div class="paragraph">
<p>我们假设你有一个数组。你被要求返回该数组的唯一值, 并且按从大到小的顺序排序。</p>
</div>
<div class="paragraph">
<p>下面是没有使用链式调用的代码：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">my @array       = &lt;7 8 9 0 1 2 4 3 5 6 7 8 9 &gt;;
my @final-array = reverse(sort(unique(@array)));
say @final-array;</code></pre>
</div>
</div>
<div class="paragraph">
<p>首先我们在 <code>@array</code> 上调用 <code>unique</code> 函数, 然后我们把它的结果作为参数传递给 <code>sort</code> 函数, 再然后我们把结果传递给 <code>reverse</code> 函数。</p>
</div>
<div class="paragraph">
<p>和上面的例子相比, Raku 允许链式方法。<br/>
上面的例子可以像下面这样写, 利用 <strong>方法链</strong> 的优点:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">my @array       = &lt;7 8 9 0 1 2 4 3 5 6 7 8 9 &gt;;
my @final-array = @array.unique.sort.reverse;
say @final-array;</code></pre>
</div>
</div>
<div class="paragraph">
<p>你已经看到链式方法看起来有多 <em>清爽</em> 啦。</p>
</div>
</div>
<div class="sect2">
<h3 id="_feed_操作符">8.4. Feed 操作符</h3>
<div class="paragraph">
<p><strong>feed 操作符</strong>, 在有些函数式编程语言中也叫 <em>管道</em>, 然而它是链式方法的一个更好的可视化产出。</p>
</div>
<div class="listingblock">
<div class="title">正向流（Forward Feed）</div>
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">my @array = &lt;7 8 9 0 1 2 4 3 5 6&gt;;
@array ==&gt; unique()
       ==&gt; sort()
       ==&gt; reverse()
       ==&gt; my @final-array;
say @final-array;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">解释</div>
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">从 `@array` 开始 然后 返回一个唯一元素的列表
                然后 排序它
                然后 反转它
                然后 把结果保存到 @final-array 中</code></pre>
</div>
</div>
<div class="paragraph">
<p>就像你看到的那样, 方法的流向是自上而下的。</p>
</div>
<div class="listingblock">
<div class="title">反向流（Backward Feed）</div>
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">my @array = &lt;7 8 9 0 1 2 4 3 5 6&gt;;
my @final-array-v2 &lt;== reverse()
                   &lt;== sort()
                   &lt;== unique()
                   &lt;== @array;
say @final-array-v2;</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">解释</div>
<p>正向流就像反向流一样, 但是是以反转的顺序写的。<br/></p>
</div>
<div class="paragraph">
<p>方法的流动方向是自下而上。</p>
</div>
</div>
<div class="sect2">
<h3 id="_hyper_操作符">8.5. Hyper 操作符</h3>
<div class="paragraph">
<p><strong>hyper 操作符</strong> <code>&gt;&gt;.</code> 对列表的所有元素调用同一方法，返回其结果的列表。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">my @array = &lt;0 1 2 3 4 5 6 7 8 9 10&gt;;
sub is-even($var) { $var %% 2 };

say @array&gt;&gt;.is-prime;
say @array&gt;&gt;.&amp;is-even;</code></pre>
</div>
</div>
<div class="paragraph">
<p>我们能通过使用 hyper 操作符，调用 Raku 中已经定义过的方法。例如 <code>is-prime</code> 告诉我们一个数字是否是质数。<br/></p>
</div>
<div class="paragraph">
<p>此外我们能定义新的子例程并使用 hyper 操作符调用它们。但是这时我们必须在方法的名字前面加上 <code>&amp;</code> 符号。例如 <code>&amp;is-even</code>。</p>
</div>
<div class="paragraph">
<p>这很实用，因为我们不必写 <code>for</code> 循环就可以迭代每个值。</p>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Raku 会保证结果的顺序与原始值的顺序相同。<br/>
但是 <strong>不能保证</strong> Raku 会真正地在同一个顺序或在同一个线程中调用该方法。<br/>
因此，请注意具有副作用的方法，例如 <code>say</code> 或 <code>print</code>。
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="_junction">8.6. Junction</h3>
<div class="paragraph">
<p><strong>junction</strong> 是值的逻辑叠加。</p>
</div>
<div class="paragraph">
<p>在下面的例子中 <code>1|2|3</code> 是一个junction。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">my $var = 2;
if $var == 1|2|3 {
    say &#34;The variable is 1 or 2 or 3&#34;
}</code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>junction 的使用常常触发 **自动线程化**; 每个 junction 元素都执行该操作, 并且所有的结果被组合到一个新的 junction 中并返回。</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_惰性列表">8.7. 惰性列表</h3>
<div class="paragraph">
<p><strong>惰性列表</strong> 是被惰性求值的列表。<br/>
惰性求值延迟表达式的计算直到需要时, 并把结果存储到查询表中以避免重复计算。</p>
</div>
<div class="paragraph">
<p>惰性列表的优点包括:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>通过避免不必要的计算带来的性能提升</p>
</li>
<li>
<p>构建潜在的无限数据结构的能力</p>
</li>
<li>
<p>定义控制流的能力</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>我们使用中缀操作符 <code>...</code> 来创建惰性列表。<br/>
惰性列表具有 <strong>初始元素</strong>, <strong>生成器</strong> 和 <strong>结束点</strong>。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">. 简单惰性列表
----
my  $lazylist = (1 ... 10);
say $lazylist;
----</code></pre>
</div>
</div>
<div class="paragraph">
<p>初始元素为 1 而结束点为 10。因为没有定义生成器所以默认的生成器为后继生成器(+1)。<br/>
换句话说, 这个惰性列表可能返回(如果需要的话)下面的元素 (1, 2, 3, 4, 5, 6, 7, 8, 9, 10)。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">. 无穷惰性列表
----
my  $lazylist = (1 ... Inf);
say $lazylist;
----</code></pre>
</div>
</div>
<div class="paragraph">
<p>该列表可能返回(如果需要的话) 1 到无穷大之间的任何整数, 换句话说, 可以返回任何整数。</p>
</div>
<div class="listingblock">
<div class="title">使用推断生成器创建惰性列表</div>
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">my  $lazylist = (0,2 ... 10);
say $lazylist;</code></pre>
</div>
</div>
<div class="paragraph">
<p>初始的元素是 0 和 2 而结束点是 10。虽然没有定义生成器, 但是使用了初始元素, Raku 会把生成器推断为 (+2)。<br/></p>
</div>
<div class="paragraph">
<p>这个惰性列表可能返回(如果需要的话)下面的元素 (0, 2, 4, 6, 8, 10)。</p>
</div>
<div class="listingblock">
<div class="title">使用定义的生成器创建惰性列表</div>
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">my  $lazylist = (0, { $_ + 3 } ... 12);
say $lazylist;</code></pre>
</div>
</div>
<div class="paragraph">
<p>在这个例子中, 我们在闭合 <code>{ }</code> 中显式地定义了一个生成器。<br/></p>
</div>
<div class="paragraph">
<p>这个惰性列表可能返回(如果需要的话)下面的元素 (0, 3, 6, 9, 12)。</p>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>当使用显式的生成器时, 结束点必须是生成器能返回的一个值。<br/></p>
</div>
<div class="paragraph">
<p>如果在上面的例子中我们使用的结束点是 10 而非 12, 那么生成器就不会停止。生成器会 <em>跳过</em> 那个结束点。</p>
</div>
<div class="paragraph">
<p>你可以使用 <code>0 ...^ * &gt; 10</code> 代替 <code>0 ... 10</code>。<br/>
你可以把它读作: 从 0 直到第一个大于 10 的值（不包含该值）。</p>
</div>
<div class="listingblock">
<div class="title">这不会使生成器停止</div>
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">my  $lazylist = (0, { $_ + 3 } ... 10);
say $lazylist;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">这会使生成器停止</div>
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">my  $lazylist = (0, { $_ + 3 } ...^ * &gt; 10);
say $lazylist;</code></pre>
</div>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="_闭包">8.8. 闭包</h3>
<div class="paragraph">
<p>在 Raku 中所有的代码对象都是闭包, 这意味着它们能从外部作用域(outer scope)引用词法变量(lexical variables)。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">sub generate-greeting {
    my $name = &#34;John Doe&#34;;
    sub greeting {
      say &#34;Good Morning $name&#34;;
    };
    return &amp;greeting;
}
my $generated = generate-greeting;
$generated();</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果你运行上面的代码，它将在终端上显示 <code>Good Morning John Doe</code>。<br/>
虽然结果相当简单，但这个例子有趣的是，<code>greeting</code> 内部子程序在执行之前是从外部子例程中返回的。</p>
</div>
<div class="paragraph">
<p><code>$generated</code> 已经变成了 <strong>闭包</strong>。</p>
</div>
<div class="paragraph">
<p><strong>闭包</strong> 是一种特殊类型的对象，它结合了两个东西：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>子例程</p>
</li>
<li>
<p>创建该子例程的环境。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>该环境由创建闭包时在作用域内的任何局部变量组成。
在这种情况下，<code>$generated</code> 是一个闭包，它包含在创建闭包时存在的 <code>greeting</code> 子例程和 <code>John Doe</code> 字符串。</p>
</div>
<div class="paragraph">
<p>让我们来看一个更有趣的例子。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">sub greeting-generator($period) {
  return sub ($name) {
    return &#34;Good $period $name&#34;
  }
}
my $morning = greeting-generator(&#34;Morning&#34;);
my $evening = greeting-generator(&#34;Evening&#34;);

say $morning(&#34;John&#34;);
say $evening(&#34;Jane&#34;);</code></pre>
</div>
</div>
<div class="paragraph">
<p>在这个例子中，我们定义了一个子例程  <code>greeting-generator($period)</code>，它接受单个参数 <code>$period</code> 并返回一个新的子例程。新的子例程接受单个参数 <code>$name</code> 并返回构造好的问候语。</p>
</div>
<div class="paragraph">
<p>基本上，<code>greeting-generator</code> 是一个子例程工厂。在这个例子中，我们使用了 <code>greeting-generator</code> 来创建两个新的子例程，一个说 <code>Good Morning</code> ，一个说 <code>Good Evening</code>。</p>
</div>
<div class="paragraph">
<p><code>$morning</code> 和 <code>$evening</code> 都是闭包。它们共享相同的子例程主体定义，但存储不同的环境。<br/>
在 <code>$morning</code> 的环境中 <code>$period</code> 是 <code>Morning</code>。在 <code>$evening</code> 的环境中 <code>$period</code> 是 <code>Evening</code>。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_类和对象">9. 类和对象</h2>
<div class="sectionbody">
<div class="paragraph">
<p>在上一章中我们学习了 Raku 中函数式编程的便利性。<br/>
在这一章中我们将看看 Raku 中的面向对象编程。</p>
</div>
<div class="sect2">
<h3 id="_介绍">9.1. 介绍</h3>
<div class="paragraph">
<p><em>面向对象</em> 编程是当今广泛使用的范式之一。<br/>
<strong>对象</strong> 是一组绑定在一起的变量和子例程。<br/></p>
</div>
<div class="paragraph">
<p>其中的变量叫做 <strong>属性</strong>, 而子例程被叫做 <strong>方法</strong>。<br/>
属性定义对象的 <strong>状态</strong>, 而方法定义对象的 <strong>行为</strong>。</p>
</div>
<div class="paragraph">
<p><strong>类</strong> 是创建 <strong>对象</strong> 的模板。</p>
</div>
<div class="paragraph">
<p>为了理解它们之间的关系, 考虑下面的例子:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;"/>
<col style="width: 50%;"/>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">房间里有 4 个人</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>对象</strong> ⇒ 4 people</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">这 4 个人是人类</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>类</strong> ⇒ Human</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">它们有不同的名字,年纪,性别和国籍</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>属性</strong> ⇒ name,age,sex,nationality</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>按 <em>面向对象</em> 的说法, 对象是类的 <strong>实例</strong>。</p>
</div>
<div class="paragraph">
<p>考虑下面的脚本:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">class Human {
  has $.name;
  has $.age;
  has $.sex;
  has $.nationality;
}

my $john = Human.new(name =&gt; &#39;John&#39;, age =&gt; 23, sex =&gt; &#39;M&#39;, nationality =&gt; &#39;American&#39;);
say $john;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>class</code> 关键字用于定义类。<br/>
<code>has</code> 关键字用于定义类的属性。<br/>
<code>.new</code> 方法被称之为 <strong>构造函数</strong>。它创建了对象作为类的实例。</p>
</div>
<div class="paragraph">
<p>在上面的例子中, 新的变量 <code>$john</code> 保存了由 <code>Human.new()</code> 所定义的新 &#34;Human&#34; 实例。<br/>
传递给 <code>.new()</code> 方法的参数用于设置底层对象的属性。
类可以使用 <code>my</code> 来声明一个 <em>本地作用域</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">my class Human {

}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_封装">9.2. 封装</h3>
<div class="paragraph">
<p>封装是一个面向对象的概念, 它把一组数据和方法捆绑在一块。<br/>
对象中的数据(属性)应该是 <strong>私有的</strong>, 换句话说, 只能从对象内部访问它。<br/>
为了从对象外部访问对象的属性, 我们使用叫做 <strong>存取器</strong> 的方法。</p>
</div>
<div class="paragraph">
<p>下面两个脚本拥有同样的结果。</p>
</div>
<div class="listingblock">
<div class="title">直接访问变量:</div>
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">my  $var = 7;
say $var;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">封装:</div>
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">my $var = 7;
sub sayvar {
    $var;
}
say sayvar;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>sayvar</code> 是一个存取器。它让我们通过不直接访问这个变量来访问这个变量。
在 Raku 中使用  <strong>twigil</strong> 使得封装很便利。<br/>
twigil 是次级的 <em>魔符(sigil)</em> ，用于魔符和属性名之间。<br/>
有两种 twigil 可用于类中:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>!</code> 用于显式地声明属性是私有的</p>
</li>
<li>
<p><code>.</code> 用于为属性自动生成存取器</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>默认地, 所有的属性都是私有的, 但是总是用 <code>!</code> twigil 是一个好习惯。</p>
</div>
<div class="paragraph">
<p>因此, 我们应该把上面的类重写成下面这样:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">class Human {
    has $!name;
    has $!age;
    has $!sex;
    has $!nationality;
}

my $john = Human.new(name =&gt; &#39;John&#39;, age =&gt; 23, sex =&gt; &#39;M&#39;, nationality =&gt; &#39;American&#39;);
say $john;</code></pre>
</div>
</div>
<div class="paragraph">
<p>给脚本追加这样的的语句: <code>say $john.age</code>;<br/>
它会返回这样的错误: <code>Method &#39;age&#39; not found for invocant of class &#39;Human&#39; 在类’Human’中没有找到请求的方法’age&#39;</code>。<br/>
原因是 <code>$!age</code> 是私有的并且只能用于对象内部。 尝试在对象外部访问它会返回一个错误。</p>
</div>
<div class="paragraph">
<p>现在用 <code>has $.age</code> 代替 <code>$!age</code> 并看看 <code>say $john.age;</code> 的结果是什么。</p>
</div>
</div>
<div class="sect2">
<h3 id="_具名参数_vs_位置参数">9.3. 具名参数 vs. 位置参数</h3>
<div class="paragraph">
<p>在 Raku 中, 所有的类继承了一个默认的 <code>.new</code> 构造函数。<br/>
通过为他提供参数, 它能用于创建对象。<br/>
只能提供 <strong>具名参数</strong> 给默认的构造函数。<br/></p>
</div>
<div class="paragraph">
<p>如果你考虑上面的例子, 你会看到所有提供给 <code>.new</code> 方法的参数都是按名字定义的:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>name =&gt; &#39;John&#39;</p>
</li>
<li>
<p>age  =&gt; 23</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>假如我不想在每次创建新对象的时候为每个属性提供一个名字呢?<br/>
那么我需要创建另外一个接收 <strong>位置参数</strong> 的构造函数。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">class Human {
    has $.name;
    has $.age;
    has $.sex;
    has $.nationality;

    # 重写默认构造函数的新构造函数
    method new ($name, $age, $sex, $nationality) {
        self.bless(:$name, :$age, :$sex, :$nationality);
    }
}

my $john = Human.new(&#39;John&#39;, 23, &#39;M&#39;, &#39;American&#39;);
say $john;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_方法">9.4. 方法</h3>
<div class="sect3">
<h4 id="_介绍_2">9.4.1. 介绍</h4>
<div class="paragraph">
<p>方法是对象的 <em>子例程</em>。<br/>
像子例程一样, 方法是一种打包一组功能的手段, 它们接收 <strong>参数</strong>, 拥有 <strong>签名</strong> 并可以被定义为 <strong>multi</strong>。</p>
</div>
<div class="paragraph">
<p>方法是使用关键字 <code>method</code> 来定义的。<br/>
正常情况下, 方法被要求在对象的属性身上执行一些动作。这强制了封装的概念。对象的属性只能在对象里面使用方法来操作。在对象外面, 只能和对象的方法交互, 并且不能访问它的属性。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">class Human {
  has $.name;
  has $.age;
  has $.sex;
  has $.nationality;
  has $.eligible;
  method assess-eligibility {
      if self.age &lt; 21 {
          $!eligible = &#39;No&#39;
      } else {
          $!eligible = &#39;Yes&#39;
      }
  }
}

my $john = Human.new(name =&gt; &#39;John&#39;, age =&gt; 23, sex =&gt; &#39;M&#39;, nationality =&gt; &#39;American&#39;);
$john.assess-eligibility;
say $john.eligible;</code></pre>
</div>
</div>
<div class="paragraph">
<p>一旦方法定义在类中, 它们就能在对象身上使用 <em>点记号</em> 来调用:<br/>
<em>object</em> <strong>.</strong> <em>method</em>  或像上面的例子那样: <code>$john.assess-eligibility</code>。</p>
</div>
<div class="paragraph">
<p>在方法的定义中, 如果我们需要引用对象本身以调用另一个方法, 则使用 <code>self</code> 关键字。<br/></p>
</div>
<div class="paragraph">
<p>在方法的定义中, 如果我们需要引用属性, 则使用 <code>!</code> , 即使属性是使用 <code>.</code> 定义的。<br/>
理由是 <code>.</code> twigil 做的就是使用 <code>!</code> 声明一个属性并自动创建存取器。</p>
</div>
<div class="paragraph">
<p>在上面的例子中, <code>if self.age &lt; 21</code> 和  <code>if $!age &lt; 21</code> 会有同样的效果, 尽管它们从技术上来讲是不同的:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>self.age</code> 调用了 <code>.age</code> 方法(存取器)<br/>
二选一, 还能写成 <code>$.age</code></p>
</li>
<li>
<p><code>$!age</code> 是直接调用那个变量</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_私有方法">9.4.2. 私有方法</h4>
<div class="paragraph">
<p>正常的方法能从类的外面在对象身上调用。</p>
</div>
<div class="paragraph">
<p><strong>私有方法</strong> 是只能从类的内部调用的方法。<br/>
一个可能的使用情况是一个方法调用另外一个执行特定动作的方法。
连接外部世界的方法是公共的而被引用的那个方法应该保持私有。我们不想让用户直接调用它, 所以我们把它声明为私有的。</p>
</div>
<div class="paragraph">
<p>私有方法的声明需要在方法的名字前使用 <code>!</code> twigil。<br/>
私有方法是使用 <code>!</code> 而非 <code>.</code> 调用的。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">method !iamprivate {
    # code goes in here
}

method iampublic {
    self!iamprivate;
    # do additional things
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_类属性">9.5. 类属性</h3>
<div class="paragraph">
<p><strong>类属性</strong> 是属于类自身而非类的对象的属性。<br/>
它们能在定义期间初始化。<br/>
类属性是使用 <code>my</code> 关键字而非 <code>has</code> 关键字声明的。<br/>
它们是在类自己身上而非它的对象身上调用的。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">class Human {
    has $.name;
    my  $.counter = 0;
    method new($name) {
      Human.counter++;
      self.bless(:$name);
    }
}
my $a = Human.new(&#39;a&#39;);
my $b = Human.new(&#39;b&#39;);

say Human.counter;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_访问类型">9.6. 访问类型</h3>
<div class="paragraph">
<p>到现在为止我们看到的所以例子都使用存取器来从对象属性中获取信息。</p>
</div>
<div class="paragraph">
<p>假如我们需要修改属性的值呢? <br/></p>
</div>
<div class="paragraph">
<p>我们需要使用下面的 <code>is rw</code> 关键字把它标记为 <em>read/write</em>。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">class Human {
    has $.name;
    has $.age is rw;
}
my $john = Human.new(name =&gt; &#39;John&#39;, age =&gt; 21);
say $john.age;

$john.age = 23;
say $john.age;</code></pre>
</div>
</div>
<div class="paragraph">
<p>默认地, 所有属性都声明为 <em>只读</em>, 但是你可以显式地使用 <code>is readonly</code> 来声明。</p>
</div>
</div>
<div class="sect2">
<h3 id="_继承">9.7. 继承</h3>
<div class="sect3">
<h4 id="_介绍_3">9.7.1. 介绍</h4>
<div class="paragraph">
<p><strong>继承</strong> 是面向对象编程的另一个概念。</p>
</div>
<div class="paragraph">
<p>当定义类的时候, 很快我们会意思到很多属性/方法在很多类中是共有的。<br/>
我们应该重复代码吗?<br/>
不! 我们应该使用 <strong>继承</strong>。</p>
</div>
<div class="paragraph">
<p>假设我们想定义两个类, 一个类是 Human, 一个类是 Employees。<br/>
Human 拥有两个属性: name 和 age。<br/>
Employees 拥有 4  个属性: name, age, company 和 salary。</p>
</div>
<div class="paragraph">
<p>尝试按照下面的方式定义类:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">class Human {
    has $.name;
    has $.age;
}

class Employee {
    has $.name;
    has $.age;
    has $.company;
    has $.salary;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>虽然上面的代码技术上是正确的, 但是概念上差。</p>
</div>
<div class="paragraph">
<p>更好的写法是下面这样:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">class Human {
    has $.name;
    has $.age;
}
class Employee is Human {
    has $.company;
    has $.salary;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>is</code> 关键字定义了继承。<br/>
按面向对象的说法, Employee 是 Human 的 <strong>孩子</strong>, 而 Human 是 Employee 的 <strong>父亲</strong>。</p>
</div>
<div class="paragraph">
<p>所有的子类继承了父类的属性和方法, 所以没有必要重新定义它们。</p>
</div>
</div>
<div class="sect3">
<h4 id="_重写">9.7.2. 重写</h4>
<div class="paragraph">
<p>类从它们的父类中继承所有的属性和方法。<br/>
有些情况下, 我们需要让子类中的方法表现得和继承的方法不一样。<br/>
为了做到这, 我们在子类中重新定义方法。<br/>
这个概念就叫做 <strong>重写</strong>。</p>
</div>
<div class="paragraph">
<p>在下面的例子中, <code>introduce-yourself</code> 方法被 Employee 类继承。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">class Human {
    has $.name;
    has $.age;
    method introduce-yourself {
      say &#39;Hi 我是人类, 我的名字是 &#39; ~ self.name;
    }
}

class Employee is Human {
    has $.company;
    has $.salary;
}

my $john = Human.new(name =&gt; &#39;John&#39;, age =&gt; 23,);
my $jane = Employee.new(name =&gt; &#39;Jane&#39;, age =&gt; 25, company =&gt; &#39;Acme&#39;, salary =&gt; 4000);

$john.introduce-yourself;
$jane.introduce-yourself;</code></pre>
</div>
</div>
<div class="paragraph">
<p>重写工作如下:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">class Human {
    has $.name;
    has $.age;
    method introduce-yourself {
      say &#39;Hi 我是人类, 我的名字是 &#39; ~ self.name;
    }
}

class Employee is Human {
    has $.company;
    has $.salary;
    method introduce-yourself {
      say &#39;Hi 我是一名员工, 我的名字是 &#39; ~ self.name ~ &#39; 我工作在: &#39; ~ self.company;
    }
}

my $john = Human.new(name =&gt;&#39;John&#39;,age =&gt; 23,);
my $jane = Employee.new(name =&gt;&#39;Jane&#39;,age =&gt; 25,company =&gt; &#39;Acme&#39;,salary =&gt; 4000);

$john.introduce-yourself;
$jane.introduce-yourself;</code></pre>
</div>
</div>
<div class="paragraph">
<p>根据对象所属的类, 会调用正确的方法。</p>
</div>
</div>
<div class="sect3">
<h4 id="_submethod">9.7.3. Submethod</h4>
<div class="paragraph">
<p><strong>submethod</strong> 是一种子类继承不到的方法。<br/>
它们只能从所声明的类中访问。<br/>
它们使用 <code>submethod</code> 关键字定义。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_多重继承">9.8. 多重继承</h3>
<div class="paragraph">
<p>在 Raku 中允许多重继承。一个类可以继承自多个其它的类。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">class bar-chart {
  has Int @.bar-values;
  method plot {
    say @.bar-values;
  }
}

class line-chart {
  has Int @.line-values;
  method plot {
    say @.line-values;
  }
}

class combo-chart is bar-chart is line-chart {
}

my $actual-sales   = bar-chart.new(bar-values =&gt; [10,9,11,8,7,10]);
my $forecast-sales = line-chart.new(line-values =&gt; [9,8,10,7,6,9]);

my $actual-vs-forecast = combo-chart.new(bar-values =&gt; [10,9,11,8,7,10],
                                         line-values =&gt; [9,8,10,7,6,9]);
say &#34;实际的销售: &#34;;
$actual-sales.plot;
say &#34;预测的销售: &#34;;
$forecast-sales.plot;
say &#34;实际 vs 预测:&#34;;
$actual-vs-forecast.plot;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><code>输出</code></div>
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">实际的销售:
[10 9 11 8 7 10]
预测的销售:
[9 8 10 7 6 9]
实际 vs 预测:
[10 9 11 8 7 10]</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">解释</div>
<p><code>combo-chart</code> 类应该能持有两个序列, 一个是绘制条形图的实际值, 另一个是绘制折线图的预测值。<br/>
这就是我们为什么把它定义为 <code>line-chart</code> 和 <code>bar-chart</code> 的孩子的原因。<br/>
你应该注意到了, 在 <code>combo-chart</code> 身上调用 <code>plot</code> 方法并没有产生所要求的结果。它只绘制了一个序列。<br/>
发生了什么事?<br/></p>
</div>
<div class="paragraph">
<p><code>combo-chart</code> 继承自 <code>line-chart</code> 和 <code>bar-chart</code>, 它们都有一个叫做 <code>plot</code> 的方法。当我们在 <code>combo-chart</code> 身上调用那个方法时, Raku 内部会尝试通过调用其所继承的方法之一来解决冲突。</p>
</div>
<div class="paragraph">
<div class="title">纠正</div>
<p>为了表现得正确, 我们应该在 <code>combo-chart</code> 中重写 <code>plot</code> 方法。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">class bar-chart {
  has Int @.bar-values;
  method plot {
    say @.bar-values;
  }
}

class line-chart {
  has Int @.line-values;
  method plot {
    say @.line-values;
  }
}

class combo-chart is bar-chart is line-chart {
  method plot {
    say @.bar-values;
    say @.line-values;
  }
}

my $actual-sales = bar-chart.new(bar-values =&gt; [10,9,11,8,7,10]);
my $forecast-sales = line-chart.new(line-values =&gt; [9,8,10,7,6,9]);

my $actual-vs-forecast = combo-chart.new(bar-values =&gt; [10,9,11,8,7,10],
                                         line-values =&gt; [9,8,10,7,6,9]);
say &#34;实际的销售: &#34;;
$actual-sales.plot;
say &#34;预测的销售: &#34;;
$forecast-sales.plot;
say &#34;实际 vs 预测:&#34;;
$actual-vs-forecast.plot;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><code>输出</code>（译注，截至2019.4.30，这段代码在实现中的输出与预期不一致，参见 <a href="https://github.com/hankache/perl6intro/issues/192" class="bare">https://github.com/hankache/perl6intro/issues/192</a> ）</div>
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">实际的销售:
[10 9 11 8 7 10]
预测的销售:
[9 8 10 7 6 9]
实际 vs 预测:
[10 9 11 8 7 10]
[9 8 10 7 6 9]</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_role">9.9. Role</h3>
<div class="paragraph">
<p><strong>role</strong> 也是属性和方法的集合，在这个意义上它和类（class）有些相似。
role 使用关键字 <code>role</code> 声明, 而想实现该 role 的类可以使用 <code>does</code> 关键字。</p>
</div>
<div class="listingblock">
<div class="title">使用 role 重写多重继承的例子</div>
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">role bar-chart {
  has Int @.bar-values;
  method plot {
    say @.bar-values;
  }
}

role line-chart {
  has Int @.line-values;
  method plot {
    say @.line-values;
  }
}

class combo-chart does bar-chart does line-chart {
  method plot {
    say @.bar-values;
    say @.line-values;
  }
}

my $actual-sales = bar-chart.new(bar-values =&gt; [10,9,11,8,7,10]);
my $forecast-sales = line-chart.new(line-values =&gt; [9,8,10,7,6,9]);

my $actual-vs-forecast = combo-chart.new(bar-values =&gt; [10,9,11,8,7,10],
                                         line-values =&gt; [9,8,10,7,6,9]);
say &#34;实际的销售: &#34;;
$actual-sales.plot;
say &#34;预测的销售: &#34;;
$forecast-sales.plot;
say &#34;实际 vs 预测:&#34;;
$actual-vs-forecast.plot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>运行上面的脚本你会看到结果是一样的。</p>
</div>
<div class="paragraph">
<p>现在你问问自己, 如果 role 表现得像类的话那么它们的用途是什么呢?<br/></p>
</div>
<div class="paragraph">
<p>要回答你的问题, 修改第一个用于展示多重继承的脚本,  这个脚本中我们 <em>忘记</em> 重写 <code>plot</code> 方法了。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">role bar-chart {
  has Int @.bar-values;
  method plot {
    say @.bar-values;
  }
}

role line-chart {
  has Int @.line-values;
  method plot {
    say @.line-values;
  }
}

class combo-chart does bar-chart does line-chart {
}

my $actual-sales = bar-chart.new(bar-values =&gt; [10,9,11,8,7,10]);
my $forecast-sales = line-chart.new(line-values =&gt; [9,8,10,7,6,9]);

my $actual-vs-forecast = combo-chart.new(bar-values =&gt; [10,9,11,8,7,10],
                                         line-values =&gt; [9,8,10,7,6,9]);
say &#34;Actual sales:&#34;;
$actual-sales.plot;
say &#34;Forecast sales:&#34;;
$forecast-sales.plot;
say &#34;Actual vs Forecast:&#34;;
$actual-vs-forecast.plot;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><code>输出</code></div>
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">===SORRY!===
Method &#39;plot&#39; must be resolved by class combo-chart because it exists in multiple roles (line-chart, bar-chart)
类&#39;combo-chart&#39;的方法&#39;plot&#39;必须被决定，因为存在多个role（line-chart, bar-chart）</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">解释</div>
<p>如果多个 role 被应用到同一个类中, 会出现冲突并抛出一个编译时错误。<br/>
这是比多重继承更安全的方法, 其中冲突不被认为是错误并且简单地在运行时解决。</p>
</div>
<div class="paragraph">
<p>role 会提醒你有冲突。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">class Human {
  has Str $.name;
  has Int $.age;
  method introduce-yourself {
    say &#39;Hi I am a human being, my name is &#39; ~ self.name;
  }
}

class Employee is Human {
  has Str $.company;
  has Int $.salary;
  method introduce-yourself {
    say &#39;Hi I am a employee, my name is &#39; ~ self.name ~ &#39; and I work at: &#39; ~ self.company;
  }
}

my $john = Human.new(name =&gt;&#39;John&#39;,age =&gt; 23,);
my $jane = Employee.new(name =&gt;&#39;Jane&#39;,age =&gt; 25,company =&gt; &#39;Acme&#39;,salary =&gt; 4000);

say $john.WHAT;
say $jane.WHAT;
say $john.^attributes;
say $jane.^attributes;
say $john.^methods;
say $jane.^methods;
say $jane.^parents;
if $jane ~~ Human {say &#39;Jane is a Human&#39;};</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_内省">9.10. 内省</h3>
<div class="paragraph">
<p><strong>内省</strong> 是获取诸如对象的类型、属性或方法等对象属性的信息的过程。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">class Human {
  has Str $.name;
  has Int $.age;
  method introduce-yourself {
    say &#39;Hi i am a human being, my name is &#39; ~ self.name;
  }
}

class Employee is Human {
  has Str $.company;
  has Int $.salary;
  method introduce-yourself {
    say &#39;Hi i am a employee, my name is &#39; ~ self.name ~ &#39; and I work at: &#39; ~ self.company;
  }
}

my $john = Human.new(name =&gt;&#39;John&#39;,age =&gt; 23,);
my $jane = Employee.new(name =&gt;&#39;Jane&#39;,age =&gt; 25,company =&gt; &#39;Acme&#39;,salary =&gt; 4000);

say $john.WHAT;
say $jane.WHAT;
say $john.^attributes;
say $jane.^attributes;
say $john.^methods;
say $jane.^methods;
say $jane.^parents;
if $jane ~~ Human {say &#39;Jane is a Human&#39;};</code></pre>
</div>
</div>
<div class="paragraph">
<p>内省使用了:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>.WHAT</code>  返回已经创建的对象所属的类。</p>
</li>
<li>
<p><code>.^attributes</code> 返回一个包含该对象所有属性的列表。</p>
</li>
<li>
<p><code>.^mtethods</code> 返回能在该对象身上调用的所有方法。</p>
</li>
<li>
<p><code>.^parents</code> 返回该对象所属类的所有父类。</p>
</li>
<li>
<p><code>~~</code> 叫做智能匹配操作符。
如果对象是从它所进行比较的类或任何它继承的类创建的, 则计算为 True。</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>有关 Raku 中面向对象编程的更多信息，请参阅：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.raku.org/language/classtut" class="bare">https://docs.raku.org/language/classtut</a></p>
</li>
<li>
<p><a href="https://docs.raku.org/language/objects" class="bare">https://docs.raku.org/language/objects</a></p>
</li>
</ul>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_异常处理">10. 异常处理</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_捕获异常">10.1. 捕获异常</h3>
<div class="paragraph">
<p><strong>异常</strong> 是当某些东西出错时发生在运行时的特殊行为。<br/>
我们说异常被 <em>抛出</em>。</p>
</div>
<div class="paragraph">
<p>考虑下面这个运行正确的脚本:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">my Str $name;
$name = &#34;Joanna&#34;;
say &#34;Hello &#34; ~ $name;
say &#34;How are you doing today?&#34;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><code>输出</code></div>
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">Hello Joanna
How are you doing today?</code></pre>
</div>
</div>
<div class="paragraph">
<p>现在考虑这个抛出异常的脚本:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">my Str $name;
$name = 123;
say &#34;Hello &#34; ~ $name;
say &#34;今天过得怎么样？&#34;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><code>输出</code></div>
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">Type check failed in assignment to $name; expected Str but got Int 赋值给$name时类型检查失败，预期Str但是得到Int
   in block &lt;unit&gt; at exceptions.raku:2</code></pre>
</div>
</div>
<div class="paragraph">
<p>你应该看到当错误出现时(在这个例子中把数组赋值给字符串变量)程序会停止并且其它行的代码不会被执行, 即使它们是正确的。</p>
</div>
<div class="paragraph">
<p><strong>异常处理</strong> 是捕获已经抛出的异常的过程以使脚本能继续工作。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">my Str $name;
try {
  $name = 123;
  say &#34;Hello &#34; ~ $name;
  CATCH {
    default {
      say &#34;请再说一次你的名字，我们在记录中找不到它。&#34;;
    }
  }
}
say &#34;今天过得怎么样？&#34;;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><code>输出</code></div>
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">请再说一次你的名字，我们在记录中找不到它。
今天过得怎么样？</code></pre>
</div>
</div>
<div class="paragraph">
<p>异常处理是使用 <code>try-catch</code> 块完成的。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">try {
  # 代码在这里运行
  # 如果有东西出错, 脚本会进入到下面的 CATCH 块中
  # 如果什么错误也没有, 那么 CATCH 块会被忽略
  CATCH {
    default {
      # 只有抛出异常时, 这儿的代码才会被求值
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>CATCH</code> 块能像定义 <code>given</code> 块那样定义。
这意味着我们能捕获并处理各种不同类型的异常。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">try {
  # 代码在这里运行
  # 如果有东西出错, 脚本会进入到下面的 CATCH 块中
  # 如果什么错误也没有, 那么 CATCH 块会被忽略
  CATCH {
    when X::AdHoc { # 当异常 X::AdHoc 被抛出时要执行的操作 }
    when X::IO { # 当异常 X::IO 被抛出时要执行的操作}
    when X::OS { # 当异常 X::OS 被抛出时要执行的操作 }
    default { # 当异常类型不属于上述任何一种时要执行的操作}
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_抛出异常">10.2. 抛出异常</h3>
<div class="paragraph">
<p>Perl  6 也允许你显式地抛出异常。<br/>
有两种类型的异常可以抛出:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>特设异常（ad-hoc exceptions）</p>
</li>
<li>
<p>类型化异常（typed exceptions）</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">特设</div>
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">my Int $age = 21;
die &#34;Error !&#34;;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">类型化</div>
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">my Int $age = 21;
X::AdHoc.new(payload =&gt; &#39;Error !&#39;).throw;</code></pre>
</div>
</div>
<div class="paragraph">
<p>使用 <code>die</code> 子例程后面跟着异常消息来抛出特设异常。</p>
</div>
<div class="paragraph">
<p>类型化异常是对象, 因此上面的例子中使用了 <code>.new()</code> 构造函数。<br/>
所有类型化异常都是从类 <code>X</code> 开始, 下面是一些例子:<br/>
<code>X::AdHoc</code> 是最简单的异常类型<br/>
<code>X::IO</code> 跟 IO 错误有关。<br/>
<code>X::OS</code> 跟 OS 错误有关。<br/>
<code>X::Str::Numeric</code> 跟把字符串强制转换为数字有关。</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
查看异常类型和相关方法的完整列表请到  <a href="https://docs.raku.org/type-exceptions.html" class="bare">https://docs.raku.org/type-exceptions.html</a>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_正则表达式">11. 正则表达式</h2>
<div class="sectionbody">
<div class="paragraph">
<p>正则表达式（regular expression）, 或 <em>regex</em> 是一个用于模式匹配的字符序列。<br/>
（译注，regular expression和regex都是“正则表达式”，后者是前者的缩写。本文中的regex同时也是Perl6的类名，它包含“Perl6专属”的用法，与其他语言甚至Perl5中的正则语法不完全一致，故不翻译，以示区分。）</p>
</div>
<div class="paragraph">
<p>理解它最简单的一种方式是把它看作模式。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">if &#39;enlightenment&#39; ~~ m/ light / {
    say &#34;enlightenment 包含单词 light&#34;;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>在这个例子中, 智能匹配操作符 <code>~~</code> 用于检查一个字符串(enlightenment)是否包含一个单词(light)。<br/></p>
</div>
<div class="paragraph">
<p>&#34;Enlightenment&#34; 与regex <code>m/ light /</code> 匹配。</p>
</div>
<div class="sect2">
<h3 id="_regex_定义">11.1. Regex 定义</h3>
<div class="paragraph">
<p>正则表达式可以按如下方式定义:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>/light/</p>
</li>
<li>
<p>m/light/</p>
</li>
<li>
<p>rx/light/</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>除非显式地指定, 否则空白是无关紧要的, <code>m/light/</code> 和 <code>m/ light /</code> 是相同的。</p>
</div>
</div>
<div class="sect2">
<h3 id="_匹配字符">11.2. 匹配字符</h3>
<div class="paragraph">
<p>字母数字字符和下划线 <code>_</code> 在表达式中是按原样写出的。<br/>
所有其它字符必须使用反斜线或用引号围起来以转义。</p>
</div>
<div class="listingblock">
<div class="title">反斜线</div>
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">if &#39;Temperature: 13&#39; ~~ m/ \: / {
    say &#34;提供的字符串包含冒号 :&#34;;
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">单引号</div>
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">if &#39;Age = 13&#39; ~~ m/ &#39;=&#39; / {
    say &#34;提供的字符串包含等号 = &#34;;
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">双引号</div>
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">if &#39;name@company.com&#39; ~~ m/ &#34;@&#34; / {
    say &#34;这是一个有效的电子邮件地址，因为它包含 @ 字符&#34;;
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_匹配字符类">11.3. 匹配字符类</h3>
<div class="paragraph">
<p>字符可以分类，我们可以用类别匹配字符。<br/>
也可以匹配该类别的反面（除此之外的所有内容）:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;"/>
<col style="width: 25%;"/>
<col style="width: 25%;"/>
<col style="width: 25%;"/>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>类别</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Regex</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>反类别</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Regex</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">单词字符 (字母数字下划线)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">除了单词字符之外的任意字符</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\W</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">数字</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\d</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">除了数字之外的任意字符</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\D</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">空白</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\s</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">除了空白之外的任意字符</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\S</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">水平空白</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\h</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">除了水平空白之外的任意字符</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\H</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">垂直空白</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\v</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">除了垂直空白之外的任意字符</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\V</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">制表符空白（Tab）</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">除了制表符空白之外的任意字符</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\T</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">换行符</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\n</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">除了换行符之外的任意字符</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\N</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">if &#34;John123&#34; ~~ / \d / {
  say &#34;这不是有效名称，不允许使用数字&#34;;
} else {
  say &#34;这是个有效名称&#34;
}
if &#34;John-Doe&#34; ~~ / \s / {
  say &#34;这个字符串包含空白&#34;;
} else {
  say &#34;这个字符串不包含空白&#34;
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_unicode_属性">11.4. Unicode 属性</h3>
<div class="paragraph">
<p>就像之前章节看到的, 匹配字符类很方便。<br/>
话虽这么说，更系统的方法是使用 Unicode 属性。<br/>
这样就可以让你匹配在 ASCII 标准内和标准外的字符集。
Unicode 属性闭合在 <code>&lt;: &gt;</code> 中。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">if &#34;Devanagari Numbers १२३&#34; ~~ / &lt;:N&gt; / {
  say &#34;包含数字&#34;;
} else {
  say &#34;不包含数字&#34;
}

if &#34;Привет, Иван.&#34; ~~ / &lt;:Lu&gt; / {
  say &#34;包含大写字母&#34;;
} else {
  say &#34;不包含大写字母&#34;
}

if &#34;John-Doe&#34; ~~ / &lt;:Pd&gt; / {
  say &#34;包含破折号&#34;;
} else {
  say &#34;不包含破折号&#34;
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_通配符">11.5. 通配符</h3>
<div class="paragraph">
<p>通配符也可以用在 regex 中。</p>
</div>
<div class="paragraph">
<p>点 <code>.</code> 意味着任何单个字符。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">if &#39;abc&#39; ~~ m/ a.c / {
    say &#34;匹配&#34;;
}

if &#39;a2c&#39; ~~ m/ a.c / {
    say &#34;匹配&#34;;
}

if &#39;ac&#39; ~~ m/ a.c / {
    say &#34;匹配&#34;;
  } else {
    say &#34;不匹配&#34;;
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_量词">11.6. 量词</h3>
<div class="paragraph">
<p>量词在字符后面用于指定我们期望匹配它前面的东西的次数。</p>
</div>
<div class="paragraph">
<p>问号 <code>?</code> 意思是 0 或 1 次。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">if &#39;ac&#39; ~~ m/ a?c / {
    say &#34;匹配&#34;;
  } else {
    say &#34;不匹配&#34;;
}

if &#39;c&#39; ~~ m/ a?c / {
    say &#34;匹配&#34;;
  } else {
    say &#34;不匹配&#34;;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>星号 <code>*</code> 意思是 0 或多次。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">if &#39;az&#39; ~~ m/ a*z / {
    say &#34;匹配&#34;;
  } else {
    say &#34;不匹配&#34;;
}

if &#39;aaz&#39; ~~ m/ a*z / {
    say &#34;匹配&#34;;
  } else {
    say &#34;不匹配&#34;;
}

if &#39;aaaaaaaaaaz&#39; ~~ m/ a*z / {
    say &#34;匹配&#34;;
  } else {
    say &#34;不匹配&#34;;
}

if &#39;z&#39; ~~ m/ a*z / {
    say &#34;匹配&#34;;
  } else {
    say &#34;不匹配&#34;;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>+</code> 意思是至少匹配 1 次。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">if &#39;az&#39; ~~ m/ a+z / {
    say &#34;匹配&#34;;
  } else {
    say &#34;不匹配&#34;;
}

if &#39;aaz&#39; ~~ m/ a+z / {
    say &#34;匹配&#34;;
  } else {
    say &#34;不匹配&#34;;
}

if &#39;aaaaaaaaaaz&#39; ~~ m/ a+z / {
    say &#34;匹配&#34;;
  } else {
    say &#34;不匹配&#34;;
}

if &#39;z&#39; ~~ m/ a+z / {
    say &#34;匹配&#34;;
  } else {
    say &#34;不匹配&#34;;
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_匹配结果">11.7. 匹配结果</h3>
<div class="paragraph">
<p>当匹配字符串的regex成功时,
匹配结果被存储在一个特殊的变量 <code>$/</code> 中。</p>
</div>
<div class="listingblock">
<div class="title">脚本</div>
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">if &#39;Rakudo is a Raku compiler&#39; ~~ m/:s Raku/ {
    say &#34;匹配的内容是：&#34; ~ $/;
    say &#34;匹配之前的字符串：&#34; ~ $/.prematch;
    say &#34;匹配之后的字符串：&#34; ~ $/.postmatch;
    say &#34;匹配从字符串此处开始：&#34; ~ $/.from;
    say &#34;匹配从字符串此处结束：&#34; ~ $/.to;
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">输出</div>
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">匹配的内容是：Raku
匹配之前的字符串：Rakudo is a
匹配之后的字符串： compiler
匹配从字符串此处开始：12
匹配从字符串此处结束：18</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">解释</div>
<p><code>$/</code> 返回一个 <em>Match Object</em> (匹配 regex 的字符串)。<br/>
下面的方法可以在 <em>Match Object</em> 身上调用:<br/></p>
</div>
<div class="paragraph">
<p><code>.prematch</code> 返回匹配前面的字符串<br/>
<code>.postmatch</code> 返回匹配后面的字符串<br/>
<code>.from</code> 返回匹配的开始位置<br/>
<code>.to</code> 返回匹配的结束位置<br/></p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
默认地，空白符在 regex 中会被忽略。<br/>
如果想在 regex 中包含空白, 我们必须显式地这样做。<br/>
regex <code>m/:s Raku/</code> 中的 <code>:s</code> 用于强制匹配空白符。
另外, 可以把 regex 写为 <code>m/Perl\s6/</code> ，使用 <code>\s</code> 代表空白符。
如果 regex 中包含的空白不止一个, 使用 <code>:s</code> 比使用 <code>\s</code> 更高效。
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="_例子">11.8. 例子</h3>
<div class="paragraph">
<p>让我们检查一个邮件是否合法。<br/>
我们假设一个合法的电子邮件地址的形式如下:<br/>
名 [点] 姓 [at] 公司名 [点] (com/org/net)</p>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
这个例子中用于电子邮件检测的 regex 不是很准确。<br/>
它的核心意图是用来解释 Raku 中的 regex 的功能的。<br/>
不要在生产中原样使用它。
</td>
</tr>
</tbody></table>
</div>
<div class="listingblock">
<div class="title">脚本</div>
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">my $email = &#39;john.doe@perl6.org&#39;;
my $regex = / &lt;:L&gt;+\.&lt;:L&gt;+\@&lt;:L+:N&gt;+\.&lt;:L&gt;+ /;

if $email ~~ $regex {
  say $/ ~ &#34; 是一个合法的Email地址&#34;;
} else {
  say &#34;这不是合法的Email地址&#34;;
}</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">输出</div>
<p><code>john.doe@perl6.org 是一个合法的Email地址</code></p>
</div>
<div class="paragraph">
<div class="title">解释</div>
<p><code>&lt;:L&gt;</code>  匹配一个字母<br/>
<code>&lt;:L&gt;+</code> 匹配至少一个字母<br/>
<code>\.</code>  匹配单个 . 符号<br/>
<code>\@</code>  匹配单个 @ 符号<br/>
<code>&lt;:L+:N&gt;</code> 匹配一个字母或数字<br/>
<code>&lt;:L+:N&gt;+</code> 匹配至少一个字母或数字<br/></p>
</div>
<div class="paragraph">
<p>其中的 regex 可以分解成如下:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>名</strong> <code>&lt;:L&gt;+</code></p>
</li>
<li>
<p><strong>[点]</strong> <code>\.</code></p>
</li>
<li>
<p><strong>姓</strong> <code>&lt;:L&gt;+</code></p>
</li>
<li>
<p><strong>[at]</strong> <code>\@</code></p>
</li>
<li>
<p><strong>公司名</strong> <code>&lt;:L+:N&gt;+</code></p>
</li>
<li>
<p><strong>[点]</strong> <code>\.</code></p>
</li>
<li>
<p><strong>com/org/net</strong> <code>&lt;:L&gt;+</code></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">可选的, 一个 regex 可以被分解成多个具名 regex  。</div>
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">my $email = &#39;john.doe@perl6.org&#39;;
my regex 多个字母 { &lt;:L&gt;+ };
my regex 点 { \. };
my regex at { \@ };
my regex 多个字母与数字 { &lt;:L+:N&gt;+ };

if $email ~~ / &lt;多个字母&gt; &lt;点&gt; &lt;多个字母&gt; &lt;at&gt; &lt;多个字母与数字&gt; &lt;点&gt; &lt;多个字母&gt; / {
  say $/ ~ &#34; 是一个合法的Email地址&#34;;
} else {
  say &#34;这不是合法的Email地址&#34;;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>具名 regex 是使用 <code>my regex 表达式名 { regex 定义 }</code> 定义的。<br/>
具名 regex 可以使用 <code>&lt;表达式名&gt;</code> 来调用。</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
更多关于 regex 的内容, 查看 <a href="https://docs.raku.org/language/regexes" class="bare">https://docs.raku.org/language/regexes</a>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_raku_模块">12. Raku 模块</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Raku是通用编程语言。 它可以用于处理众多任务，包括：
文本处理，图形，网络，数据库，网络协议等。</p>
</div>
<div class="paragraph">
<p>可重用性是一个非常重要的概念，程序员不必在每次他们想要执行新任务时重新发明轮子。</p>
</div>
<div class="paragraph">
<p>Raku 允许创建和重新分发 <strong>modules</strong>。 每个模块是一组封装的功能，可以在安装后重复使用。</p>
</div>
<div class="paragraph">
<p><em>Zef</em> 是 Rakudo Star 中自带的模块管理工具。</p>
</div>
<div class="paragraph">
<p>要安装指定的模块, 在终端中键入如下命令:</p>
</div>
<div class="paragraph">
<p><code>zef install &#34;module name&#34;</code></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Raku 的模块目录可以在 <a href="https://modules.raku.org/" class="bare">https://modules.raku.org/</a> 中找到。
</td>
</tr>
</tbody></table>
</div>
<div class="sect2">
<h3 id="_使用模块">12.1. 使用模块</h3>
<div class="paragraph">
<p>MD5 是一个关于密码的散列函数，它产生一个128位的散列值。<br/>
MD5 有多种加密存储在数据库中的口令的应用程序。
当新用户注册时，其证书并不存储为纯文本，而是 <em>哈希</em>。
这样做的理由是，如果该数据库被破解，攻击者将不能够知道口令是什么。</p>
</div>
<div class="paragraph">
<p>比方说，你需要一个生成密码的MD5哈希以存储在数据库中备用的脚本。</p>
</div>
<div class="paragraph">
<p>幸运的是， Raku 已经有一个能实现 MD5 算法的模块。我们来安装它:<br/>
<code>zef install Digest::MD5</code></p>
</div>
<div class="paragraph">
<p>现在运行下面的脚本:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">use Digest::MD5;
my $password = &#34;password123&#34;;
my $hashed-password = Digest::MD5.new.md5_hex($password);

say $hashed-password;</code></pre>
</div>
</div>
<div class="paragraph">
<p>为了运行创建哈希的 <code>md5_hex()</code> 函数, 我们需要加载需要的模块。<br/>
<code>use</code> 关键字用于在脚本中加载模块。</p>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
实际上，MD5 哈希是不够的，因为它容易被字典攻击。<br/>
它应该加盐。<a href="https://zh.wikipedia.org/wiki/%E7%9B%90_(%E5%AF%86%E7%A0%81%E5%AD%A6)">维基百科：盐 (密码学)</a>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_unicode">13. Unicode</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Unicode 是编码并表现文本的标准, 它涵盖了世界上大多数书写系统。<br/>
UTF-8 是能够以Unicode编码所有可能的字符或代码点的字符编码。</p>
</div>
<div class="paragraph">
<p>字符的定义是通过:<br/></p>
</div>
<div class="paragraph">
<p><strong>字素</strong>: 视觉表示<br/>
<strong>代码点</strong>: 赋值给字符的数字<br/>
<strong>代码点名称</strong>: 字符的名称</p>
</div>
<div class="sect2">
<h3 id="_使用_unicode">13.1. 使用 Unicode</h3>
<div class="listingblock">
<div class="title">让我们看一下使用 Unicode 能输出什么</div>
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">say &#34;a&#34;;
say &#34;\x0061&#34;;
say &#34;\c[LATIN SMALL LETTER A]&#34;;</code></pre>
</div>
</div>
<div class="paragraph">
<p>上面 3 行展示了构建字符的不同方法:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>直接写出字符(字素)</p>
</li>
<li>
<p>使用 <code>\x</code> 和代码点</p>
</li>
<li>
<p>使用 <code>\c</code> 和代码点名字</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="title">现在我们来输出笑脸</div>
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">say &#34;☺&#34;;
say &#34;\x263a&#34;;
say &#34;\c[WHITE SMILING FACE]&#34;;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">组合两个代码点的另外一个例子</div>
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">say &#34;á&#34;;
say &#34;\x00e1&#34;;
say &#34;\x0061\x0301&#34;;
say &#34;\c[LATIN SMALL LETTER A WITH ACUTE]&#34;;</code></pre>
</div>
</div>
<div class="paragraph">
<p>字母 <code>á</code> 可以被写为:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>使用它的唯一代码点 <code>\x00e1</code></p>
</li>
<li>
<p>或作为 <code>a</code> 和 重音符号 <code>\x0061\x0301</code> 代码点的组合</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">有些方法可以使用</div>
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">say &#34;á&#34;.NFC;
say &#34;á&#34;.NFD;
say &#34;á&#34;.uniname;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><code>输出</code></div>
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">NFC:0x&lt;00e1&gt;
NFD:0x&lt;0061 0301&gt;
LATIN SMALL LETTER A WITH ACUTE</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>NFC</code> 返回唯一的代码点。<br/>
<code>NFD</code> 分解(decompose)那个字符并返回每部分的代码点。<br/>
<code>uniname</code> 返回代码点的名字。</p>
</div>
<div class="listingblock">
<div class="title">Unicode 字符可以用作标识符:</div>
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">my $Δ = 1;
$Δ++;
say $Δ;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Unicode 可以用作做算术:</div>
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">my $var = 2 + ⅒;
say $var;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_unicode_相关的操作符">13.2. Unicode 相关的操作符</h3>
<div class="sect3">
<h4 id="_数字">13.2.1. 数字</h4>
<div class="paragraph">
<p>10 个阿拉伯数字 &#34;0, 1, 2, 3, 4, 5, 6, 7, 8, 9&#34; 是今天全世界使用最广泛的数字字符集。</p>
</div>
<div class="paragraph">
<p>不过在全世界各地其他数字字符集也少量地被使用。</p>
</div>
<div class="paragraph">
<p>在使用不同数字字符集的时候，不需要特别的留意。所有方法、操作符都会像在阿拉伯数字上那样工作。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">say (٤,٥,٦,1,2,3).sort;  # (1 2 3 4 5 6)
say 1 + ٩;               # 10</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_字符串">13.2.2. 字符串</h4>
<div class="paragraph">
<p>我们在进行字符串操作的时候，结果可能不会像我们期待的那样，特别是在进行比较或排序的时候。</p>
</div>
<div class="sect4">
<h5 id="_比较">比较</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">say &#39;a&#39; cmp &#39;B&#39;; # More</code></pre>
</div>
</div>
<div class="paragraph">
<p>上面的例子显示 <code>a</code> 要比 <code>B</code> 更大。这是因为小写 <code>a</code> 的代码点比大写 <code>B</code> 的代码点大。</p>
</div>
<div class="paragraph">
<p>虽然这在技术上是对的，不过它可能不是我们所期待的。</p>
</div>
<div class="paragraph">
<p>幸运的是 Raku 拥有一套应用了 <a href="http://unicode.org/reports/tr10/">Unicode 排序算法</a>的操作符。<br/>
<code>unicmp</code> 是其中一个，它的功能和上面的 <code>cmp</code> 相似，不过是 unicode 相关的。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">say &#39;a&#39; unicmp &#39;B&#39;; # Less</code></pre>
</div>
</div>
<div class="paragraph">
<p>你看到了吗，使用 <code>unicmp</code> 操作符的时候得到 <code>a</code> 小于 <code>B</code> 的结果。</p>
</div>
</div>
<div class="sect4">
<h5 id="_排序">排序</h5>
<div class="paragraph">
<p>Raku 提供了 <code>collate</code> 方法来替代代码点排序方法 <code>sort</code> 应用于 unicode，<code>collate</code> 应用了 <a href="http://unicode.org/reports/tr10/">Unicode 排序算法</a>。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">say (&#39;a&#39;,&#39;b&#39;,&#39;c&#39;,&#39;D&#39;,&#39;E&#39;,&#39;F&#39;).sort;    # (D E F a b c)
say (&#39;a&#39;,&#39;b&#39;,&#39;c&#39;,&#39;D&#39;,&#39;E&#39;,&#39;F&#39;).collate; # (a b c D E F)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_并行并发和异步">14. 并行、并发和异步</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_并行">14.1. 并行</h3>
<div class="paragraph">
<p>在正常情况下, 程序中的所有任务都是相继地运行的。<br/>
这可能不是个事儿除非你正尝试去做的东西需要耗费很多时间。</p>
</div>
<div class="paragraph">
<p>幸亏Raku 拥有能让你并行地运行的功能。<br/>
此时, 需要注意到的是存在两类并行方式：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>任务并行化</strong>: 两个(或更多)独立的表达式并行地运行。</p>
</li>
<li>
<p><strong>数据并行化</strong>: 单个表达式并行地迭代列表中的元素。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>让我们从后者开始。</p>
</div>
<div class="sect3">
<h4 id="_数据并行化">14.1.1. 数据并行化</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">my @array = (0..50000);                     # 数组总体
my @result = @array.map({ is-prime $_ });   # 为每个数组元素调用 is-prime（判断是否为质数）
say now - INIT now;                         # 输出脚本完成花费的时间</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">考虑上面的例子:</div>
<p>我们只做一个操作 <code>@array.map({is-prime $_})</code>。<br/>
<code>is-prime</code> 子例程相继被每个数组元素所调用:<br/>
<code>is-prime @array[0]</code> 然后是 <code>is-prime @array[1]</code> 然后是 <code>is-prime @array[2]</code> 等等。</p>
</div>
<div class="listingblock">
<div class="title">幸运的是, 我们能同时在多个数组元素身上调用 <code>is-prime</code> 函数:</div>
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">my @array = (0..50000);                         # 数组总体
my @result = @array.race.map({ is-prime $_ });  # 为每个数组元素调用 is-prime（判断是否为质数）
say now - INIT now;                             # 输出完成所花费的时间</code></pre>
</div>
</div>
<div class="paragraph">
<p>注意表达式中使用的 <code>race</code>。这个方法会使数组元素能够并行地迭代。</p>
</div>
<div class="paragraph">
<p>运行两个例子(使用和不使用 <code>race</code>)运行之后, 比较两个脚本运行结束所花费的时间。</p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>race</code> 不会保存元素的顺序。如果你想那样做, 使用 <code>hyper</code> 代替。</p>
</div>
<div class="listingblock">
<div class="title">race</div>
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">my @array = (1..1000);
my @result = @array.race.map( {$_ + 1} );
@result».say;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">hyper</div>
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">my @array = (1..1000);
my @result = @array.hyper.map( {$_ + 1} );
@result».say;</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果你俩个脚本都运行了, 你应该注意到一个排序了, 一个没有排序。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="_任务并行化">14.1.2. 任务并行化</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">my @array1 = (0..49999);
my @array2 = (2..50001);

my @result1 = @array1.map( {is-prime($_ + 1)} );
my @result2 = @array2.map( {is-prime($_ - 1)} );

say @result1 == @result2;

say now - INIT now;</code></pre>
</div>
</div>
<div class="olist arabic">
<div class="title">考虑上面的例子:</div>
<ol class="arabic">
<li>
<p>我们定义了 2 个数组</p>
</li>
<li>
<p>对每个数组应用不同的操作并保存结果</p>
</li>
<li>
<p>并检查两个结果是否相同</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>该脚本等到 <code>@array1.map( {is-prime($_ +1)} )</code> 完成<br/>
然后计算 <code>@array1.map( {is-prime($_ +1)} )</code>。</p>
</div>
<div class="paragraph">
<p>应用到每个数组的俩个操作彼此间没有依赖。</p>
</div>
<div class="listingblock">
<div class="title">为什么不并行地执行呢?</div>
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">my @array1 = (0..49999);
my @array2 = (2..50001);

my $promise1 = start @array1.map( {$_ + 1} );
my $promise2 = start @array2.map( {$_ - 1} );

my @result1 = await $promise1;
my @result2 = await $promise2;

say @result1 == @result2;

say now - INIT now;</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">解释</div>
<p><code>start</code> 方法计算它后面的代码并返回 <strong>promise 类型的对象</strong> 或 <strong>promise</strong>。<br/>
如果代码被正确地求值, 那么 <em>promise</em> 会被 <strong>保留</strong>(kept)。<br/>
如果代码抛出异常, 那么 <em>promise</em> 会被 <strong>破坏</strong>(broken)。</p>
</div>
<div class="paragraph">
<p><code>await</code> 子例程等待一个 <strong>promise</strong>。<br/>
如果那个 promise 是被 <strong>保留</strong> 的, await 会获取到返回值。<br/>
如果那个 promise 是被 <strong>破坏</strong> 的, await 会获取到抛出异常。</p>
</div>
<div class="paragraph">
<p>检查每个脚本完成所花费的时间。</p>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
并行总是添加线程开销。如果开销抵消不了运算速度的增长，那么该脚本会显得较慢。<br/>
这就是为什么，在很简单的脚本中使用 <code>race</code>，<code>hyper</code>，<code>start</code> 和 <code>await</code> 实际上可以使它们慢下来。
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_并发和异步">14.2. 并发和异步</h3>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
关于并发和异步编程的更多信息, 请查看  <a href="https://docs.raku.org/language/concurrency" class="bare">https://docs.raku.org/language/concurrency</a>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_native_calling_接口">15. Native Calling 接口</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Raku 可以让我们通过 Native Calling 接口来使用 C 库。</p>
</div>
<div class="paragraph">
<p><code>NativeCall</code> 是 Raku 自带的标准模块，它提供了一系列功能方便了 Raku 和 C 的接口。</p>
</div>
<div class="sect2">
<h3 id="_调用函数">15.1. 调用函数</h3>
<div class="paragraph">
<p>下面的 C 代码定义了一个名为 <code>hellofromc</code> 的函数。
这个函数的功能是在终端中打印 <code>Hello from C</code>。它不接收参数，也不返回值。</p>
</div>
<div class="listingblock">
<div class="title">ncitest.c</div>
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">#include &lt;stdio.h&gt;

void hellofromc () {
  printf(&#34;Hello from C\n&#34;);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>根据你的操作系统将上面的 C 代码编译成库文件。</p>
</div>
<div class="listingblock">
<div class="title">在 Linux 中:</div>
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">gcc -c -fpic ncitest.c
gcc -shared -o libncitest.so ncitest.o</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">在 Windows 中:</div>
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">gcc -c ncitest.c
gcc -shared -o ncitest.dll ncitest.o</code></pre>
</div>
</div>
<div class="paragraph">
<p>在你编译 C 库的路径下新建一个包含下面代码的 Raku 文件，并运行它。</p>
</div>
<div class="listingblock">
<div class="title">ncitest.raku</div>
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">use NativeCall;

constant LIBPATH = &#34;$*CWD/ncitest&#34;;
sub hellofromc() is native(LIBPATH) { * }

hellofromc();</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">解释</div>
<p>首先，我们声明使用 <code>NativeCall</code> 模块。<br/>
接着，我们定义了一个常量 <code>LIBPATH</code> 来存储 C 库的路径。<br/>
其中 <code>$*CWD</code> 返回当前目录。<br/>
然后，我们定义一个新的 Raku 子例程 <code>hellofromc</code> 作为 C 库中名称同为 <code>hellofromc</code> 的 C 函数之包装函数。这个 C 库就是 <code>LIBPATH</code> 所对应的。<br/>
这些是通过使用 <code>is native</code> 特征实现的。<br/>
最后，调用我们的 Perl6 子例程。</p>
</div>
<div class="paragraph">
<p>总而言之，整个过程即声明一个带有 <code>is native</code> 和 C 库名为特征的子程序。</p>
</div>
</div>
<div class="sect2">
<h3 id="_函数重命名">15.2. 函数重命名</h3>
<div class="paragraph">
<p>上面的例子中，我们看到了如何通过 <code>is native</code> 特征使用同名 Raku 子例程来包装 C 函数从而调用它。</p>
</div>
<div class="paragraph">
<p>有时我们希望更改 Raku 子例程的名称。<br/>
为此，我们需要使用 <code>is symbol</code> 特征。</p>
</div>
<div class="paragraph">
<p>下面就来修改上面的 Raku 脚本，将 Raku 子例程 <code>hellofromc</code> 重命名为 <code>hello</code>。</p>
</div>
<div class="listingblock">
<div class="title">ncitest.raku</div>
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">use NativeCall;

constant LIBPATH = &#34;$*CWD/ncitest&#34;;
sub hello() is native(LIBPATH) is symbol(&#39;hellofromc&#39;) { * }

hello();</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">解释</div>
<p>由于 Raku 子例程与对应的 C 函数不同名，我们在这里需要使用 <code>is symbol</code> 来提供原始的 C 函数名。</p>
</div>
</div>
<div class="sect2">
<h3 id="_参数传递">15.3. 参数传递</h3>
<div class="paragraph">
<p>编译下面更改过的的 C 库代码并运行 Raku 脚本。<br/>
注意我们是如何修改 C 和 Raku 代码来接收一个字符串参数（在 C 中是 <code>chr*</code>，在 Raku 中是 <code>Str</code>）</p>
</div>
<div class="listingblock">
<div class="title">ncitest.c</div>
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">#include &lt;stdio.h&gt;

void hellofromc (char* name) {
  printf(&#34;Hello, %s! This is C!\n&#34;, name);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">ncitest.raku</div>
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">use NativeCall;

constant LIBPATH = &#34;$*CWD/ncitest&#34;;
sub hello(Str) is native(LIBPATH) is symbol(&#39;hellofromc&#39;) { * }

hello(&#39;Jane&#39;);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_返回值_2">15.4. 返回值</h3>
<div class="paragraph">
<p>让我们再来定义一个简单的计算器，实现接收两个整数输入并返回它们之和。<br/>
编译下面的 C 库，并运行 Raku 脚本。</p>
</div>
<div class="listingblock">
<div class="title">ncitest.c</div>
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">int add (int a, int b) {
  return (a + b);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">ncitest.raku</div>
<div class="content">
<pre class="highlight"><code class="language-perl6" data-lang="perl6">use NativeCall;

constant LIBPATH = &#34;$*CWD/ncitest&#34;;
sub add(int32,int32) returns int32 is native(LIBPATH) { * }

say add(2,3);</code></pre>
</div>
</div>
<div class="paragraph">
<p>注意其中 C 和 Raku 函数如何接收两个整数并返回一个整数。（C 中的 <code>int</code> 和 Raku 中的 <code>int32</code>）</p>
</div>
</div>
<div class="sect2">
<h3 id="_类型_2">15.5. 类型</h3>
<div class="paragraph">
<p>你可能要问，为什么在最后的 Raku 脚本中我们要使用 <code>int32</code> 来代替 <code>Int</code> 。<br/>
因为在 Raku 中像 <code>Int</code>，<code>Rat</code> 等类型不能用来传递与接收 C 函数中的值。<br/>
所以必须在 Raku 中使用同 C 中类型相对应的类型。</p>
</div>
<div class="paragraph">
<p>幸运的是，Raku 提供了许多数据类型来对应 C 中的数据类型。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;"/>
<col style="width: 50%;"/>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle">C 类型</th>
<th class="tableblock halign-center valign-middle">Raku 类型</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>char</code></p></td>
<td class="tableblock halign-center valign-middle" rowspan="2"><p class="tableblock"><code>int8</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>int8_t</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>short</code></p></td>
<td class="tableblock halign-center valign-middle" rowspan="2"><p class="tableblock"><code>int16</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>int16_t</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>int</code></p></td>
<td class="tableblock halign-center valign-middle" rowspan="2"><p class="tableblock"><code>int32</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>int32_t</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>int64_t</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>int64</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>unsigned char</code></p></td>
<td class="tableblock halign-center valign-middle" rowspan="2"><p class="tableblock"><code>uint8</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>uint8_t</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>unsigned short</code></p></td>
<td class="tableblock halign-center valign-middle" rowspan="2"><p class="tableblock"><code>uint16</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>uint16_t</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>unsigned int</code></p></td>
<td class="tableblock halign-center valign-middle" rowspan="2"><p class="tableblock"><code>uint32</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>uint32_t</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>uint64_t</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>uint64</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>long</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>long</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>long long</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>longlong</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>float</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>num32</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>double</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>num64</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>size_t</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>size_t</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>bool</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>bool</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>char*</code> (String)</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>Str</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">Arrays: 比如 <code>int*</code> (Array of int) 和 <code>double*</code> (Array of double)</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>CArray</code>: 比如 <code>CArray[int32]</code> 和 <code>CArray[num64]</code></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
更多关于 Native Calling 接口, 详见 <a href="https://docs.raku.org/language/nativecall" class="bare">https://docs.raku.org/language/nativecall</a>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_社区">16. 社区</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="irc://irc.freenode.net/#raku">#raku</a> IRC 频道. 很多讨论发生在频道中。你可以到 <a href="http://raku.org/community/irc" class="bare">http://raku.org/community/irc</a> 进行任何询问。</p>
</li>
<li>
<p><a href="https://rakudoweekly.blog">Rakudo Weekly</a> Raku 周边的变化和每周概述。</p>
</li>
<li>
<p><a href="http://pl6anet.org">pl6anet</a> 博客聚合器. 敬请阅读专注于 Raku 的博客文章。</p>
</li>
<li>
<p><a href="https://www.reddit.com/r/rakulang/">/r/rakulang</a> 订阅 Raku 子版本。</p>
</li>
<li>
<p><a href="https://twitter.com/perl6org">@perl6org</a> Perl6 社区推特</p>
</li>
<li>
<p><a href="https://alerts.perl6.org">P6lert</a> 核心开发者的提醒。及时了解重要的变动。</p>
</li>
</ul>
</div>
</div>
</div>
<div id="footnotes">
<hr/>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. 维基百科：区间 <a href="https://zh.wikipedia.org/zh-cn/%E5%8D%80%E9%96%93#%E5%9A%B4%E6%A0%BC%E5%AE%9A%E7%BE%A9" class="bare">https://zh.wikipedia.org/zh-cn/%E5%8D%80%E9%96%93#%E5%9A%B4%E6%A0%BC%E5%AE%9A%E7%BE%A9</a>
</div>
</div>

</article>


    

  </main><section class="site__search">
    <label class="site__form">
        <p class="form__label">Search around the site</p> 
        <input class="site__search-bar form__input" type="text">
    </label>
    <div class="site__search-bar-results"></div>
</section>
  
  <footer class="site__footer">
    
    
    <p class="footer__sign">© 2020 ohmyraku</p></footer>
    

    
    <script>
        window.addEventListener("load", function () {
            const script = document.createElement("script");
            script.src = "https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"
            script.async = true

            document.head.appendChild(script);
        })
    </script>





<script defer type="text/javascript" src="https://ohmyraku.github.io/js/script.14164ab553b19613ce98aadb54b1ed9a89ae5b056c72b99a4c672e37954f33d67bebe1452b0279025ba889964b51bdf8ec69683933cf427ae67c08ac2cdda7b1.js" integrity="sha512-FBZKtVOxlhPOmKrbVLHtmomuWwVscrmaTGcuN5VPM9Z76&#43;FFKwJ5AluoiZZLUb347GloOTPPQnrmfAisLN2nsQ=="></script>



</body>
</html>